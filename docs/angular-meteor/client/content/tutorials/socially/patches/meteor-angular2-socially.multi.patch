From 0331ca3acd1ab58116d85e3023b2e6212eff5f1c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 16:57:38 +0300
Subject: [PATCH 01/80] Creates tutorial app.

---
 .meteor/.finished-upgraders | 12 +++++++++
 .meteor/.id                 |  7 +++++
 .meteor/packages            | 20 ++++++++++++++
 .meteor/platforms           |  2 ++
 .meteor/release             |  1 +
 .meteor/versions            | 66 +++++++++++++++++++++++++++++++++++++++++++++
 6 files changed, 108 insertions(+)
 create mode 100644 .meteor/.finished-upgraders
 create mode 100644 .meteor/.id
 create mode 100644 .meteor/packages
 create mode 100644 .meteor/platforms
 create mode 100644 .meteor/release
 create mode 100644 .meteor/versions

diff --git a/.meteor/.finished-upgraders b/.meteor/.finished-upgraders
new file mode 100644
index 0000000..61ee313
--- /dev/null
+++ b/.meteor/.finished-upgraders
@@ -0,0 +1,12 @@
+# This file contains information which helps Meteor properly upgrade your
+# app when you run 'meteor update'. You should check it into version control
+# with your project.
+
+notices-for-0.9.0
+notices-for-0.9.1
+0.9.4-platform-file
+notices-for-facebook-graph-api-2
+1.2.0-standard-minifiers-package
+1.2.0-meteor-platform-split
+1.2.0-cordova-changes
+1.2.0-breaking-changes
diff --git a/.meteor/.id b/.meteor/.id
new file mode 100644
index 0000000..7969a61
--- /dev/null
+++ b/.meteor/.id
@@ -0,0 +1,7 @@
+# This file contains a token that is unique to your project.
+# Check it into your repository along with the rest of this directory.
+# It can be used for purposes such as:
+#   - ensuring you don't accidentally deploy one app on top of another
+#   - providing package authors with aggregated statistics
+
+pk1ynrhdqnbzrnlqkz
diff --git a/.meteor/packages b/.meteor/packages
new file mode 100644
index 0000000..a9f8340
--- /dev/null
+++ b/.meteor/packages
@@ -0,0 +1,20 @@
+# Meteor packages used by this project, one per line.
+# Check this file (and the other files in this directory) into your repository.
+#
+# 'meteor add' and 'meteor remove' will edit this file for you,
+# but you can also edit it by hand.
+
+meteor-base             # Packages every Meteor app needs to have
+mobile-experience       # Packages for a great mobile UX
+mongo                   # The database Meteor supports right now
+blaze-html-templates    # Compile .html files into Meteor Blaze views
+session                 # Client-side reactive dictionary for your app
+jquery                  # Helpful client-side library
+tracker                 # Meteor's client-side reactive programming library
+
+standard-minifiers      # JS/CSS minifiers run for production mode
+es5-shim                # ECMAScript 5 compatibility for older browsers.
+ecmascript              # Enable ECMAScript2015+ syntax in app code
+
+autopublish             # Publish all data to the clients (for prototyping)
+insecure                # Allow all DB writes from clients (for prototyping)
diff --git a/.meteor/platforms b/.meteor/platforms
new file mode 100644
index 0000000..efeba1b
--- /dev/null
+++ b/.meteor/platforms
@@ -0,0 +1,2 @@
+server
+browser
diff --git a/.meteor/release b/.meteor/release
new file mode 100644
index 0000000..238bbcc
--- /dev/null
+++ b/.meteor/release
@@ -0,0 +1 @@
+METEOR@1.2.0.1
diff --git a/.meteor/versions b/.meteor/versions
new file mode 100644
index 0000000..e378b68
--- /dev/null
+++ b/.meteor/versions
@@ -0,0 +1,66 @@
+autopublish@1.0.4
+autoupdate@1.2.3
+babel-compiler@5.8.24_1
+babel-runtime@0.1.4
+base64@1.0.4
+binary-heap@1.0.4
+blaze@2.1.3
+blaze-html-templates@1.0.1
+blaze-tools@1.0.4
+boilerplate-generator@1.0.4
+caching-compiler@1.0.0
+caching-html-compiler@1.0.1
+callback-hook@1.0.4
+check@1.0.6
+ddp@1.2.2
+ddp-client@1.2.1
+ddp-common@1.2.1
+ddp-server@1.2.1
+deps@1.0.9
+diff-sequence@1.0.1
+ecmascript@0.1.4
+ecmascript-collections@0.1.6
+ejson@1.0.7
+es5-shim@4.1.13
+fastclick@1.0.7
+geojson-utils@1.0.4
+hot-code-push@1.0.0
+html-tools@1.0.5
+htmljs@1.0.5
+http@1.1.1
+id-map@1.0.4
+insecure@1.0.4
+jquery@1.11.4
+launch-screen@1.0.4
+livedata@1.0.15
+logging@1.0.8
+meteor@1.1.7
+meteor-base@1.0.1
+minifiers@1.1.7
+minimongo@1.0.9
+mobile-experience@1.0.1
+mobile-status-bar@1.0.6
+mongo@1.1.1
+mongo-id@1.0.1
+npm-mongo@1.4.39_1
+observe-sequence@1.0.7
+ordered-dict@1.0.4
+promise@0.4.8
+random@1.0.4
+reactive-dict@1.1.1
+reactive-var@1.0.6
+reload@1.1.4
+retry@1.0.4
+routepolicy@1.0.6
+session@1.1.1
+spacebars@1.0.7
+spacebars-compiler@1.0.7
+standard-minifiers@1.0.0
+templating@1.1.3
+templating-tools@1.0.0
+tracker@1.0.8
+ui@1.0.8
+underscore@1.0.4
+url@1.0.5
+webapp@1.2.2
+webapp-hashing@1.0.5
-- 
2.5.4 (Apple Git-61)


From a2759654b831fdc60cf071096dd9ace110b38019 Mon Sep 17 00:00:00 2001
From: Alex <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:01:41 +0300
Subject: [PATCH 02/80] Create README.md

---
 README.md | 2 ++
 1 file changed, 2 insertions(+)
 create mode 100644 README.md

diff --git a/README.md b/README.md
new file mode 100644
index 0000000..61fc3ee
--- /dev/null
+++ b/README.md
@@ -0,0 +1,2 @@
+# Angular2-Meteor Tutorial
+Tutorial is based on building Angular2 UI for a Meteor app called Socially.
-- 
2.5.4 (Apple Git-61)


From 982577678528ecb16ccea76f9c4a178f09b8512f Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:03:11 +0300
Subject: [PATCH 03/80] Step 0.1: add client/index.html

---
 client/index.html | 3 +++
 1 file changed, 3 insertions(+)
 create mode 100644 client/index.html

diff --git a/client/index.html b/client/index.html
new file mode 100644
index 0000000..ef412ef
--- /dev/null
+++ b/client/index.html
@@ -0,0 +1,3 @@
+<body>
+  <p>Nothing here</p>
+</body>
-- 
2.5.4 (Apple Git-61)


From 32756437d6a3cd6144aaea879dee45187eaf6d01 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:08:36 +0300
Subject: [PATCH 04/80] Step 0.2: add Angular2 package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index a9f8340..feb8272 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,3 +18,4 @@ ecmascript              # Enable ECMAScript2015+ syntax in app code
 
 autopublish             # Publish all data to the clients (for prototyping)
 insecure                # Allow all DB writes from clients (for prototyping)
+urigo:angular2-meteor
-- 
2.5.4 (Apple Git-61)


From 8ae5857626a2964f179c35e501a301c539c94bb8 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:09:47 +0300
Subject: [PATCH 05/80] Step 0.3: remove Blaze package

---
 .meteor/packages | 1 -
 1 file changed, 1 deletion(-)

diff --git a/.meteor/packages b/.meteor/packages
index feb8272..c70808e 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -7,7 +7,6 @@
 meteor-base             # Packages every Meteor app needs to have
 mobile-experience       # Packages for a great mobile UX
 mongo                   # The database Meteor supports right now
-blaze-html-templates    # Compile .html files into Meteor Blaze views
 session                 # Client-side reactive dictionary for your app
 jquery                  # Helpful client-side library
 tracker                 # Meteor's client-side reactive programming library
-- 
2.5.4 (Apple Git-61)


From 0d456d718868498b1f3560d0c0e0a97d03bd9205 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:10:32 +0300
Subject: [PATCH 06/80] Step 0.4: remove ecmascript package

---
 .meteor/packages | 1 -
 1 file changed, 1 deletion(-)

diff --git a/.meteor/packages b/.meteor/packages
index c70808e..2f89e25 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -13,7 +13,6 @@ tracker                 # Meteor's client-side reactive programming library
 
 standard-minifiers      # JS/CSS minifiers run for production mode
 es5-shim                # ECMAScript 5 compatibility for older browsers.
-ecmascript              # Enable ECMAScript2015+ syntax in app code
 
 autopublish             # Publish all data to the clients (for prototyping)
 insecure                # Allow all DB writes from clients (for prototyping)
-- 
2.5.4 (Apple Git-61)


From f19b15265b86dfa2cc0979c877dd44a573e5eaf3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:12:43 +0300
Subject: [PATCH 07/80] Step 0.5: create root component

---
 client/app.ts | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 client/app.ts

diff --git a/client/app.ts b/client/app.ts
new file mode 100644
index 0000000..fbe1b5e
--- /dev/null
+++ b/client/app.ts
@@ -0,0 +1,13 @@
+import {Component, View} from 'angular2/core';
+
+import {bootstrap} from 'angular2/bootstrap';
+
+@Component({
+    selector: 'app'
+})
+@View({
+    template: 'Hello World!'
+})
+class Socially { }
+
+bootstrap(Socially);
-- 
2.5.4 (Apple Git-61)


From 912e28d81d9229d41aa4f458a70e0c5c9370bd0d Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:14:08 +0300
Subject: [PATCH 08/80] Step 0.6: load root component

---
 client/index.html | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/index.html b/client/index.html
index ef412ef..19d3bf1 100644
--- a/client/index.html
+++ b/client/index.html
@@ -1,3 +1,4 @@
 <body>
-  <p>Nothing here</p>
+  <app></app>
+  <script>System.import('client/app');</script>
 </body>
-- 
2.5.4 (Apple Git-61)


From 8242e0a80bc89513c1217f432e792e2ee78a43eb Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:19:17 +0300
Subject: [PATCH 09/80] Step 0.7: remove index.html

---
 client/index.html | 4 ----
 1 file changed, 4 deletions(-)
 delete mode 100644 client/index.html

diff --git a/client/index.html b/client/index.html
deleted file mode 100644
index 19d3bf1..0000000
--- a/client/index.html
+++ /dev/null
@@ -1,4 +0,0 @@
-<body>
-  <app></app>
-  <script>System.import('client/app');</script>
-</body>
-- 
2.5.4 (Apple Git-61)


From e6bf3770b2cebece713b7da9375af3f810e6f69b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:20:40 +0300
Subject: [PATCH 10/80] Step 0.8: add reference to the declaration file

---
 client/app.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index fbe1b5e..fc3cb6b 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -1,3 +1,5 @@
+/// &lt;reference path="../typings/angular2-meteor.d.ts" />
+
 import {Component, View} from 'angular2/core';
 
 import {bootstrap} from 'angular2/bootstrap';
-- 
2.5.4 (Apple Git-61)


From 90f5a583a1010eeed8efba623ad1c6dbf5b7818f Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:21:40 +0300
Subject: [PATCH 11/80] Step 0.9: create app.html template

---
 client/app.html | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 client/app.html

diff --git a/client/app.html b/client/app.html
new file mode 100644
index 0000000..a9c8ddc
--- /dev/null
+++ b/client/app.html
@@ -0,0 +1 @@
+<p>Nothing here {{ 'yet' + '!' }}</p>
-- 
2.5.4 (Apple Git-61)


From 8aa44fbdb3b0e6dd727a3654acce223ab9194847 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:22:33 +0300
Subject: [PATCH 12/80] remove versions

---
 .meteor/versions | 66 --------------------------------------------------------
 1 file changed, 66 deletions(-)
 delete mode 100644 .meteor/versions

diff --git a/.meteor/versions b/.meteor/versions
deleted file mode 100644
index e378b68..0000000
--- a/.meteor/versions
+++ /dev/null
@@ -1,66 +0,0 @@
-autopublish@1.0.4
-autoupdate@1.2.3
-babel-compiler@5.8.24_1
-babel-runtime@0.1.4
-base64@1.0.4
-binary-heap@1.0.4
-blaze@2.1.3
-blaze-html-templates@1.0.1
-blaze-tools@1.0.4
-boilerplate-generator@1.0.4
-caching-compiler@1.0.0
-caching-html-compiler@1.0.1
-callback-hook@1.0.4
-check@1.0.6
-ddp@1.2.2
-ddp-client@1.2.1
-ddp-common@1.2.1
-ddp-server@1.2.1
-deps@1.0.9
-diff-sequence@1.0.1
-ecmascript@0.1.4
-ecmascript-collections@0.1.6
-ejson@1.0.7
-es5-shim@4.1.13
-fastclick@1.0.7
-geojson-utils@1.0.4
-hot-code-push@1.0.0
-html-tools@1.0.5
-htmljs@1.0.5
-http@1.1.1
-id-map@1.0.4
-insecure@1.0.4
-jquery@1.11.4
-launch-screen@1.0.4
-livedata@1.0.15
-logging@1.0.8
-meteor@1.1.7
-meteor-base@1.0.1
-minifiers@1.1.7
-minimongo@1.0.9
-mobile-experience@1.0.1
-mobile-status-bar@1.0.6
-mongo@1.1.1
-mongo-id@1.0.1
-npm-mongo@1.4.39_1
-observe-sequence@1.0.7
-ordered-dict@1.0.4
-promise@0.4.8
-random@1.0.4
-reactive-dict@1.1.1
-reactive-var@1.0.6
-reload@1.1.4
-retry@1.0.4
-routepolicy@1.0.6
-session@1.1.1
-spacebars@1.0.7
-spacebars-compiler@1.0.7
-standard-minifiers@1.0.0
-templating@1.1.3
-templating-tools@1.0.0
-tracker@1.0.8
-ui@1.0.8
-underscore@1.0.4
-url@1.0.5
-webapp@1.2.2
-webapp-hashing@1.0.5
-- 
2.5.4 (Apple Git-61)


From 6853f3738ed3505094bc5f2261db3aaf5d31fce9 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:23:10 +0300
Subject: [PATCH 13/80] Step 0.10: change inline template to templateUrl

---
 client/app.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/app.ts b/client/app.ts
index fc3cb6b..6bf00fa 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -8,7 +8,7 @@ import {bootstrap} from 'angular2/bootstrap';
     selector: 'app'
 })
 @View({
-    template: 'Hello World!'
+    templateUrl: 'client/app.html'
 })
 class Socially { }
 
-- 
2.5.4 (Apple Git-61)


From c4a3d6687182624828f57f04ce2a3385a56900d1 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:29:40 +0300
Subject: [PATCH 14/80] Step 1.1: add static HTML to the template

---
 client/app.html | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/client/app.html b/client/app.html
index a9c8ddc..dd1ef68 100644
--- a/client/app.html
+++ b/client/app.html
@@ -1 +1,14 @@
-<p>Nothing here {{ 'yet' + '!' }}</p>
+<ul>
+  <li>
+    <span>Dubstep-Free Zone</span>
+    <p>
+      Can we please just for an evening not listen to dubstep.
+    </p>
+  </li>
+  <li>
+    <span>All dubstep all the time</span>
+    <p>
+      Get it on!
+    </p>
+  </li>
+</ul>
-- 
2.5.4 (Apple Git-61)


From 2894de2dfc599395f98b965244f8abe49093bcee Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:30:49 +0300
Subject: [PATCH 015/133] Step 2.1: use dynamic template with NgFor

---
 client/app.html | 23 +++++++++--------------
 1 file changed, 9 insertions(+), 14 deletions(-)

diff --git a/client/app.html b/client/app.html
index dd1ef68..d5876ba 100644
--- a/client/app.html
+++ b/client/app.html
@@ -1,14 +1,9 @@
-<ul>
-  <li>
-    <span>Dubstep-Free Zone</span>
-    <p>
-      Can we please just for an evening not listen to dubstep.
-    </p>
-  </li>
-  <li>
-    <span>All dubstep all the time</span>
-    <p>
-      Get it on!
-    </p>
-  </li>
-</ul>
+<div>
+  <ul>
+    <li *ngFor="#party of parties">
+      {{party.name}}
+      <p>{{party.description}}</p>
+      <p>{{party.location}}</p>
+    </li>
+  </ul>
+</div>
-- 
2.5.4 (Apple Git-61)


From a45f0e97e0fab66ef9bee686a54036cd7514ead5 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:34:52 +0300
Subject: [PATCH 016/133] Step 2.2: load parties data into the app

---
 client/app.ts | 19 ++++++++++++++++++-
 1 file changed, 18 insertions(+), 1 deletion(-)

diff --git a/client/app.ts b/client/app.ts
index 6bf00fa..4a44bbe 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -10,6 +10,23 @@ import {bootstrap} from 'angular2/bootstrap';
 @View({
     templateUrl: 'client/app.html'
 })
-class Socially { }
+class Socially {
+    constructor () {
+        this.parties = [
+          {'name': 'Dubstep-Free Zone',
+           'description': 'Can we please just for an evening not listen to dubstep.',
+           'location': 'Palo Alto'
+          },
+          {'name': 'All dubstep all the time',
+           'description': 'Get it on!',
+           'location': 'Palo Alto'
+          },
+          {'name': 'Savage lounging',
+           'description': 'Leisure suit required. And only fiercest manners.',
+           'location': 'San Francisco'
+          }
+        ];
+    }
+}
 
 bootstrap(Socially);
-- 
2.5.4 (Apple Git-61)


From c4260d9eef333fe29946e5b1ba2af4966298912b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 17:36:13 +0300
Subject: [PATCH 017/133] Step 2.3: define parties property

---
 client/app.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index 4a44bbe..e5fc57c 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -11,6 +11,8 @@ import {bootstrap} from 'angular2/bootstrap';
     templateUrl: 'client/app.html'
 })
 class Socially {
+    parties: Array&lt;Object>;
+
     constructor () {
         this.parties = [
           {'name': 'Dubstep-Free Zone',
-- 
2.5.4 (Apple Git-61)


From 00433b2bc271f5411e142519da0e9690e6e31327 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 18:30:37 +0300
Subject: [PATCH 018/133] Step 3.1:  add the parties collection

---
 collections/parties.ts | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 collections/parties.ts

diff --git a/collections/parties.ts b/collections/parties.ts
new file mode 100644
index 0000000..83fbd07
--- /dev/null
+++ b/collections/parties.ts
@@ -0,0 +1 @@
+export var Parties = new Mongo.Collection('parties');
-- 
2.5.4 (Apple Git-61)


From 5e318ea8230025c9d2cad8e32c68517687bd5f7e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 18:36:20 +0300
Subject: [PATCH 019/133] Step 3.2:  add reference to the declaration file

---
 collections/parties.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/collections/parties.ts b/collections/parties.ts
index 83fbd07..d1ed853 100644
--- a/collections/parties.ts
+++ b/collections/parties.ts
@@ -1 +1,3 @@
+/// &lt;reference path="../typings/angular2-meteor.d.ts" />
+
 export var Parties = new Mongo.Collection('parties');
-- 
2.5.4 (Apple Git-61)


From 64d64402f125091dcf825fc7f2b6f14bab98f833 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 18:36:56 +0300
Subject: [PATCH 020/133] Step 3.3:  import the parties collection

---
 client/app.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index e5fc57c..929d632 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -4,6 +4,8 @@ import {Component, View} from 'angular2/core';
 
 import {bootstrap} from 'angular2/bootstrap';
 
+import {Parties} from 'collections/parties';
+
 @Component({
     selector: 'app'
 })
-- 
2.5.4 (Apple Git-61)


From c6fe10df769bcddf25d8b75a6537311bac220dc4 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 19 Oct 2015 13:28:41 +0300
Subject: [PATCH 021/133] Step 3.4: fetch parties

---
 client/app.ts | 15 +--------------
 1 file changed, 1 insertion(+), 14 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index 929d632..a7d0c82 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -16,20 +16,7 @@ class Socially {
     parties: Array&lt;Object>;
 
     constructor () {
-        this.parties = [
-          {'name': 'Dubstep-Free Zone',
-           'description': 'Can we please just for an evening not listen to dubstep.',
-           'location': 'Palo Alto'
-          },
-          {'name': 'All dubstep all the time',
-           'description': 'Get it on!',
-           'location': 'Palo Alto'
-          },
-          {'name': 'Savage lounging',
-           'description': 'Leisure suit required. And only fiercest manners.',
-           'location': 'San Francisco'
-          }
-        ];
+        this.parties = Parties.find().fetch();
     }
 }
 
-- 
2.5.4 (Apple Git-61)


From 71ed8ece690351ce601f8929569e071a9f7c590e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Sep 2015 18:47:23 +0300
Subject: [PATCH 022/133] Step 3.5:  fetch parties reactively

---
 client/app.ts | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index a7d0c82..a4caf39 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -1,6 +1,6 @@
 /// &lt;reference path="../typings/angular2-meteor.d.ts" />
 
-import {Component, View} from 'angular2/core';
+import {Component, View, NgZone} from 'angular2/core';
 
 import {bootstrap} from 'angular2/bootstrap';
 
@@ -15,8 +15,10 @@ import {Parties} from 'collections/parties';
 class Socially {
     parties: Array&lt;Object>;
 
-    constructor () {
-        this.parties = Parties.find().fetch();
+    constructor (zone: NgZone) {
+        Tracker.autorun(() => zone.run(() => {
+            this.parties = Parties.find().fetch();
+        }));
     }
 }
 
-- 
2.5.4 (Apple Git-61)


From e6eef9f7bf9cdbeb33d91df2bf2960f681d388e6 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 8 Nov 2015 02:26:41 +0300
Subject: [PATCH 023/133] Step 3.6: initialize collection on server side

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 server/main.ts

diff --git a/server/main.ts b/server/main.ts
new file mode 100644
index 0000000..64dbcb6
--- /dev/null
+++ b/server/main.ts
@@ -0,0 +1 @@
+import 'collections/parties';
-- 
2.5.4 (Apple Git-61)


From 367a433870393378c15ca279de124d09fe6a49b6 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 14 Oct 2015 22:55:11 +0300
Subject: [PATCH 024/133] Step 3.7: Blaze-like binding to Angular2

---
 client/app.ts | 12 +++++-------
 1 file changed, 5 insertions(+), 7 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index a4caf39..7dfaf3e 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -2,10 +2,10 @@
 
 import {Component, View, NgZone} from 'angular2/core';
 
-import {bootstrap} from 'angular2/bootstrap';
-
 import {Parties} from 'collections/parties';
 
+import {bootstrap} from 'angular2-meteor';
+
 @Component({
     selector: 'app'
 })
@@ -13,12 +13,10 @@ import {Parties} from 'collections/parties';
     templateUrl: 'client/app.html'
 })
 class Socially {
-    parties: Array&lt;Object>;
+    parties: Mongo.Cursor&lt;Object>;
 
-    constructor (zone: NgZone) {
-        Tracker.autorun(() => zone.run(() => {
-            this.parties = Parties.find().fetch();
-        }));
+    constructor () {
+        this.parties = Parties.find();
     }
 }
 
-- 
2.5.4 (Apple Git-61)


From 6962a4ceff2fddd5d31be72e4fc81624e5527eea Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 14 Oct 2015 23:21:31 +0300
Subject: [PATCH 26/80] Step 3.8: load initial parties on server side

---
 server/load_parties.ts | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)
 create mode 100644 server/load_parties.ts

diff --git a/server/load_parties.ts b/server/load_parties.ts
new file mode 100644
index 0000000..65c914a
--- /dev/null
+++ b/server/load_parties.ts
@@ -0,0 +1,28 @@
+import {Parties} from 'collections/parties';
+
+export function loadParties() {
+    if (Parties.find().count() === 0) {
+
+    var parties = [
+        {
+            'name': 'Dubstep-Free Zone',
+            'description': 'Can we please just for an evening not listen to dubstep.',
+            'location': 'Palo Alto'
+        },
+        {
+            'name': 'All dubstep all the time',
+            'description': 'Get it on!',
+            'location': 'Palo Alto'
+        },
+        {
+            'name': 'Savage lounging',
+            'description': 'Leisure suit required. And only fiercest manners.',
+            'location': 'San Francisco'
+        }
+    ];
+
+    for (var i = 0; i < parties.length; i++) {
+        Parties.insert(parties[i]);
+    }
+  }
+};
-- 
2.5.4 (Apple Git-61)


From 372f6d312768204487fb5f2a22775b705a159de3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 14 Oct 2015 23:32:49 +0300
Subject: [PATCH 27/80] Step 3.9: bootstrap server side

---
 server/main.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/server/main.ts b/server/main.ts
index 64dbcb6..80ba2c9 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1 +1,3 @@
-import 'collections/parties';
+import {loadParties} from './load_parties';
+
+Meteor.startup(loadParties);
-- 
2.5.4 (Apple Git-61)


From f55559f4ba0117e5ad6fef1ecd161b0ac18e5daa Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 14:58:32 +0300
Subject: [PATCH 027/132] Step 4.1:  create PartiesForm component

---
 client/parties-form/parties-form.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/parties-form/parties-form.ts

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
new file mode 100644
index 0000000..6e02b99
--- /dev/null
+++ b/client/parties-form/parties-form.ts
@@ -0,0 +1,11 @@
+/// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+
+import {Component, View} from 'angular2/core';
+
+@Component({
+    selector: 'parties-form'
+})
+@View({
+    templateUrl: '/client/parties-form/parties-form.html'
+})
+export class PartiesForm { }
-- 
2.5.4 (Apple Git-61)


From 0ae27c955a5bca70df1407ac1de69fe025817711 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 15:48:01 +0300
Subject: [PATCH 028/132] Step 4.2: add parties-form.html template

---
 client/parties-form/parties-form.html | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 client/parties-form/parties-form.html

diff --git a/client/parties-form/parties-form.html b/client/parties-form/parties-form.html
new file mode 100644
index 0000000..df0bd89
--- /dev/null
+++ b/client/parties-form/parties-form.html
@@ -0,0 +1,9 @@
+<form>
+  <label>Name</label>
+  <input type="text">
+  <label>Description</label>
+  <input type="text">
+  <label>Location</label>
+  <input type="text">
+  <button>Add</button>
+</form>
-- 
2.5.4 (Apple Git-61)


From e70c32219d9cf17a957e642ec698108aecc55036 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 16:03:48 +0300
Subject: [PATCH 029/132] Step 4.3: load the PartiesForm component

---
 client/app.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/app.html b/client/app.html
index d5876ba..2f7c3e3 100644
--- a/client/app.html
+++ b/client/app.html
@@ -1,4 +1,5 @@
 <div>
+  <parties-form></parties-form>
   <ul>
     <li *ngFor="#party of parties">
       {{party.name}}
-- 
2.5.4 (Apple Git-61)


From 7af4ba673ec662074f10753ae88519a7ac045c63 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 16:07:36 +0300
Subject: [PATCH 030/132] Step 4.4:  import the PartiesForm component and link
 it with the Socially component

---
 client/app.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/app.ts b/client/app.ts
index 7dfaf3e..9847f48 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -6,11 +6,14 @@ import {Parties} from 'collections/parties';
 
 import {bootstrap} from 'angular2-meteor';
 
+import {PartiesForm} from 'client/parties-form/parties-form';
+
 @Component({
     selector: 'app'
 })
 @View({
-    templateUrl: 'client/app.html'
+    templateUrl: 'client/app.html',
+    directives: [PartiesForm]
 })
 class Socially {
     parties: Mongo.Cursor&lt;Object>;
-- 
2.5.4 (Apple Git-61)


From 478f44874fbbcbbae871f1b4d434f9af2d1b5a9a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 17:41:26 +0300
Subject: [PATCH 031/132] Step 4.5: build a form model

---
 client/parties-form/parties-form.ts | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
index 6e02b99..e44ab8d 100644
--- a/client/parties-form/parties-form.ts
+++ b/client/parties-form/parties-form.ts
@@ -2,10 +2,23 @@
 
 import {Component, View} from 'angular2/core';
 
+import {FormBuilder, ControlGroup, Validators} from 'angular2/common';
+
 @Component({
     selector: 'parties-form'
 })
 @View({
     templateUrl: '/client/parties-form/parties-form.html'
 })
-export class PartiesForm { }
+export class PartiesForm {
+    partiesForm: ControlGroup;
+
+    constructor() {
+        var fb = new FormBuilder();
+        this.partiesForm = fb.group({
+            name: [''],
+            description: [''],
+            location: ['']
+        });
+    }
+}
-- 
2.5.4 (Apple Git-61)


From 78aa1971277ca3b2e934539b222e1995389096e3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 18:34:57 +0300
Subject: [PATCH 032/132] Step 4.6: add form validation

---
 client/parties-form/parties-form.ts | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
index e44ab8d..f7f193a 100644
--- a/client/parties-form/parties-form.ts
+++ b/client/parties-form/parties-form.ts
@@ -16,9 +16,9 @@ export class PartiesForm {
     constructor() {
         var fb = new FormBuilder();
         this.partiesForm = fb.group({
-            name: [''],
+            name: ['', Validators.required],
             description: [''],
-            location: ['']
+            location: ['', Validators.required]
         });
     }
 }
-- 
2.5.4 (Apple Git-61)


From 14ec04dacadb92897ccf9df31235a07899b0fa03 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 20:20:32 +0300
Subject: [PATCH 033/132] Step 4.7: link the form and its model together

---
 client/parties-form/parties-form.html | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/client/parties-form/parties-form.html b/client/parties-form/parties-form.html
index df0bd89..dffc0aa 100644
--- a/client/parties-form/parties-form.html
+++ b/client/parties-form/parties-form.html
@@ -1,9 +1,9 @@
-<form>
+<form [ngFormModel]="partiesForm">
   <label>Name</label>
-  <input type="text">
+  <input type="text" ngControl="name">
   <label>Description</label>
-  <input type="text">
+  <input type="text" ngControl="description">
   <label>Location</label>
-  <input type="text">
+  <input type="text" ngControl="location">
   <button>Add</button>
 </form>
-- 
2.5.4 (Apple Git-61)


From 7688db5e82137ecca3645252fe55f917c1ba576b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 20:33:32 +0300
Subject: [PATCH 034/132] Step 4.8: add submit handler inside the template

---
 client/parties-form/parties-form.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-form/parties-form.html b/client/parties-form/parties-form.html
index dffc0aa..da869fb 100644
--- a/client/parties-form/parties-form.html
+++ b/client/parties-form/parties-form.html
@@ -1,4 +1,4 @@
-<form [ngFormModel]="partiesForm">
+<form [ngFormModel]="partiesForm" #f="ngForm" (submit)="addParty(f.value)">
   <label>Name</label>
   <input type="text" ngControl="name">
   <label>Description</label>
-- 
2.5.4 (Apple Git-61)


From a20c7d7f865e3b09203fee9017eb61b436d84dd0 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 4 Jan 2016 13:21:15 +0700
Subject: [PATCH 035/132] Step 4.9: add addParty method into the component

---
 client/parties-form/parties-form.ts | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
index f7f193a..569e21d 100644
--- a/client/parties-form/parties-form.ts
+++ b/client/parties-form/parties-form.ts
@@ -2,7 +2,9 @@
 
 import {Component, View} from 'angular2/core';
 
-import {FormBuilder, ControlGroup, Validators} from 'angular2/common';
+import {FormBuilder, Control, ControlGroup, Validators} from 'angular2/common';
+
+import {Parties} from 'collections/parties';
 
 @Component({
     selector: 'parties-form'
@@ -21,4 +23,18 @@ export class PartiesForm {
             location: ['', Validators.required]
         });
     }
+
+    addParty(party) {
+        if (this.partiesForm.valid) {
+            Parties.insert({
+                name: party.name,
+                description: party.description,
+                location: party.location
+            });
+
+            (&lt;Control>this.partiesForm.controls['name']).updateValue('');
+            (&lt;Control>this.partiesForm.controls['description']).updateValue('');
+            (&lt;Control>this.partiesForm.controls['location']).updateValue('');
+        }
+    }
 }
-- 
2.5.4 (Apple Git-61)


From b11d0b8144956263df73e9e42cf081ed07d0f3fc Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 20:57:18 +0300
Subject: [PATCH 036/132] Step 4.10: add a remove party button and click event
 handler

---
 client/app.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/app.html b/client/app.html
index 2f7c3e3..b3ec969 100644
--- a/client/app.html
+++ b/client/app.html
@@ -5,6 +5,7 @@
       {{party.name}}
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
+      <button (click)="removeParty(party)">X</button>
     </li>
   </ul>
 </div>
-- 
2.5.4 (Apple Git-61)


From 6d0c1d0f97c398bdc11934bf4ff1a2a322dfa2b4 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 17 Oct 2015 20:59:18 +0300
Subject: [PATCH 037/132] Step 4.11: Add removeParty method inside the
 component

---
 client/app.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index 9847f48..b9ede85 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -21,6 +21,10 @@ class Socially {
     constructor () {
         this.parties = Parties.find();
     }
+
+    removeParty(party) {
+        Parties.remove(party._id);
+    }
 }
 
 bootstrap(Socially);
-- 
2.5.4 (Apple Git-61)


From bc8f130ed6a86b5e8d5dec91373e4d15cf05386f Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 01:47:04 +0300
Subject: [PATCH 038/132] Step 5.1:  import routing components and add them to
 the app

---
 client/app.ts | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index b9ede85..12dbe26 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -8,12 +8,14 @@ import {bootstrap} from 'angular2-meteor';
 
 import {PartiesForm} from 'client/parties-form/parties-form';
 
+import {ROUTER_PROVIDERS, ROUTER_DIRECTIVES, RouteConfig} from 'angular2/router';
+
 @Component({
     selector: 'app'
 })
 @View({
     templateUrl: 'client/app.html',
-    directives: [PartiesForm]
+    directives: [PartiesForm, ROUTER_DIRECTIVES]
 })
 class Socially {
     parties: Mongo.Cursor&lt;Object>;
@@ -27,4 +29,4 @@ class Socially {
     }
 }
 
-bootstrap(Socially);
+bootstrap(Socially, [ROUTER_PROVIDERS]);
-- 
2.5.4 (Apple Git-61)


From 54d9a0a1adbabc49e5073eb64716aee8d0bfdb56 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 01:49:04 +0300
Subject: [PATCH 039/132] Step 5.2:  create PartiesList component

---
 client/parties-list/parties-list.ts | 26 ++++++++++++++++++++++++++
 1 file changed, 26 insertions(+)
 create mode 100644 client/parties-list/parties-list.ts

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
new file mode 100644
index 0000000..3bebb49
--- /dev/null
+++ b/client/parties-list/parties-list.ts
@@ -0,0 +1,26 @@
+/// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+
+import {Component, View} from 'angular2/core';
+
+import {Parties} from 'collections/parties';
+
+import {PartiesForm} from 'client/parties-form/parties-form';
+
+@Component({
+    selector: 'parties-list'
+})
+@View({
+    templateUrl: '/client/parties-list/parties-list.html',
+    directives: [PartiesForm]
+})
+export class PartiesList {
+    parties: Mongo.Cursor&lt;Object>;
+
+    constructor() {
+        this.parties = Parties.find();
+    }
+
+    removeParty(party) {
+        Parties.remove(party._id);
+    }
+}
-- 
2.5.4 (Apple Git-61)


From b754fbf015c540f684e729b2d9592d1ba4dab438 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 01:49:43 +0300
Subject: [PATCH 040/132] Step 5.3:  add PartiesList template

---
 client/parties-list/parties-list.html | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/parties-list/parties-list.html

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
new file mode 100644
index 0000000..b3ec969
--- /dev/null
+++ b/client/parties-list/parties-list.html
@@ -0,0 +1,11 @@
+<div>
+  <parties-form></parties-form>
+  <ul>
+    <li *ngFor="#party of parties">
+      {{party.name}}
+      <p>{{party.description}}</p>
+      <p>{{party.location}}</p>
+      <button (click)="removeParty(party)">X</button>
+    </li>
+  </ul>
+</div>
-- 
2.5.4 (Apple Git-61)


From 5a8907cf9e55e3c61b9a1ffaeb0e314106b49ba0 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 01:59:44 +0300
Subject: [PATCH 041/132] Removes app.html

---
 client/app.html | 11 -----------
 1 file changed, 11 deletions(-)
 delete mode 100644 client/app.html

diff --git a/client/app.html b/client/app.html
deleted file mode 100644
index b3ec969..0000000
--- a/client/app.html
+++ /dev/null
@@ -1,11 +0,0 @@
-<div>
-  <parties-form></parties-form>
-  <ul>
-    <li *ngFor="#party of parties">
-      {{party.name}}
-      <p>{{party.description}}</p>
-      <p>{{party.location}}</p>
-      <button (click)="removeParty(party)">X</button>
-    </li>
-  </ul>
-</div>
-- 
2.5.4 (Apple Git-61)


From fa4164ba06affc4398c004967007b94e544f3d44 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 02:03:06 +0300
Subject: [PATCH 042/132] Step 5.4:  clean up Socally component

---
 client/app.ts | 19 ++-----------------
 1 file changed, 2 insertions(+), 17 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index 12dbe26..38268c5 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -2,31 +2,16 @@
 
 import {Component, View, NgZone} from 'angular2/core';
 
-import {Parties} from 'collections/parties';
-
 import {bootstrap} from 'angular2-meteor';
 
-import {PartiesForm} from 'client/parties-form/parties-form';
-
 import {ROUTER_PROVIDERS, ROUTER_DIRECTIVES, RouteConfig} from 'angular2/router';
 
 @Component({
     selector: 'app'
 })
 @View({
-    templateUrl: 'client/app.html',
-    directives: [PartiesForm, ROUTER_DIRECTIVES]
+    directives: [ROUTER_DIRECTIVES]
 })
-class Socially {
-    parties: Mongo.Cursor&lt;Object>;
-
-    constructor () {
-        this.parties = Parties.find();
-    }
-
-    removeParty(party) {
-        Parties.remove(party._id);
-    }
-}
+class Socially {}
 
 bootstrap(Socially, [ROUTER_PROVIDERS]);
-- 
2.5.4 (Apple Git-61)


From dfaa8903fcd68697176559e5f3e68b3e5700422c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 02:14:40 +0300
Subject: [PATCH 043/132] Step 5.5:  add PartyDetails component

---
 client/party-details/party-details.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/party-details/party-details.ts

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
new file mode 100644
index 0000000..0bac8f2
--- /dev/null
+++ b/client/party-details/party-details.ts
@@ -0,0 +1,11 @@
+/// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+
+import {Component, View} from 'angular2/core';
+
+@Component({
+  selector: 'party-details'
+})
+@View({
+  templateUrl: '/client/party-details/party-details.html'
+})
+export class PartyDetails {}
-- 
2.5.4 (Apple Git-61)


From c42449582f7ffc54e4e8f5752934ea4152cf3638 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 02:15:46 +0300
Subject: [PATCH 044/132] Step 5.6:  add PartyDetails template

---
 client/party-details/party-details.html | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 client/party-details/party-details.html

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
new file mode 100644
index 0000000..63fdaea
--- /dev/null
+++ b/client/party-details/party-details.html
@@ -0,0 +1,5 @@
+<header>
+  <h2>PARTY_NAME</h2>
+
+  <p>PARTY_DESCRIPTION</p>
+</header>
-- 
2.5.4 (Apple Git-61)


From c0bdff5e7ac5ba97a9e0f6f6b11226db3c3e4d03 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 02:19:18 +0300
Subject: [PATCH 045/132] Step 5.7:  configure routes

---
 client/app.ts | 15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/client/app.ts b/client/app.ts
index 38268c5..b537b76 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -1,17 +1,26 @@
 /// &lt;reference path="../typings/angular2-meteor.d.ts" />
 
-import {Component, View, NgZone} from 'angular2/core';
+import {Component, View, NgZone, provide} from 'angular2/core';
 
 import {bootstrap} from 'angular2-meteor';
 
-import {ROUTER_PROVIDERS, ROUTER_DIRECTIVES, RouteConfig} from 'angular2/router';
+import {ROUTER_PROVIDERS, ROUTER_DIRECTIVES, RouteConfig, APP_BASE_HREF} from 'angular2/router';
+
+import {PartiesList} from 'client/parties-list/parties-list';
+
+import {PartyDetails} from 'client/party-details/party-details';
 
 @Component({
     selector: 'app'
 })
 @View({
+    template: '&lt;router-outlet>&lt;/router-outlet>',
     directives: [ROUTER_DIRECTIVES]
 })
+@RouteConfig([
+    { path: '/', as: 'PartiesList', component: PartiesList },
+    { path: '/party/:partyId', as: 'PartyDetails', component: PartyDetails }
+])
 class Socially {}
 
-bootstrap(Socially, [ROUTER_PROVIDERS]);
+bootstrap(Socially, [ROUTER_PROVIDERS, provide(APP_BASE_HREF, { useValue: '/' })]);
-- 
2.5.4 (Apple Git-61)


From cf072cb2bffd6d2a360bc45cfdfd0f250edfbd9a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 03:17:25 +0300
Subject: [PATCH 046/132] Step 5.8:  import RouterLink directive

---
 client/parties-list/parties-list.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 3bebb49..be99f44 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -6,12 +6,14 @@ import {Parties} from 'collections/parties';
 
 import {PartiesForm} from 'client/parties-form/parties-form';
 
+import {RouterLink} from 'angular2/router';
+
 @Component({
     selector: 'parties-list'
 })
 @View({
     templateUrl: '/client/parties-list/parties-list.html',
-    directives: [PartiesForm]
+    directives: [PartiesForm, RouterLink]
 })
 export class PartiesList {
     parties: Mongo.Cursor&lt;Object>;
-- 
2.5.4 (Apple Git-61)


From 86f66f7ef9144f70638c46de9ff5f0f2a579420c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 12 Dec 2015 17:06:34 +0300
Subject: [PATCH 047/132] Step 5.9: add links to the parties list

---
 client/parties-list/parties-list.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index b3ec969..03c9607 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -2,7 +2,7 @@
   <parties-form></parties-form>
   <ul>
     <li *ngFor="#party of parties">
-      {{party.name}}
+      <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
       <button (click)="removeParty(party)">X</button>
-- 
2.5.4 (Apple Git-61)


From 3145326008444e69b626f520c7431afee8451f85 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 20:11:55 +0300
Subject: [PATCH 048/132] Step 5.10:  injecting route parameters

---
 client/party-details/party-details.ts | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 0bac8f2..2ee5fe0 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -2,10 +2,16 @@
 
 import {Component, View} from 'angular2/core';
 
+import {RouteParams} from 'angular2/router';
+
 @Component({
-  selector: 'party-details'
+    selector: 'party-details'
 })
 @View({
-  templateUrl: '/client/party-details/party-details.html'
+    templateUrl: '/client/party-details/party-details.html'
 })
-export class PartyDetails {}
+export class PartyDetails {
+    constructor(params: RouteParams) {
+        var partyId = params.get('partyId');
+    }
+}
-- 
2.5.4 (Apple Git-61)


From ddc1e5a7cd9c305b7c8b098337c0fe97ae893e85 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 20:44:54 +0300
Subject: [PATCH 049/132] Step 5.11:  load party details

---
 client/party-details/party-details.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 2ee5fe0..b831db7 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -4,6 +4,8 @@ import {Component, View} from 'angular2/core';
 
 import {RouteParams} from 'angular2/router';
 
+import {Parties} from 'collections/parties';
+
 @Component({
     selector: 'party-details'
 })
@@ -11,7 +13,10 @@ import {RouteParams} from 'angular2/router';
     templateUrl: '/client/party-details/party-details.html'
 })
 export class PartyDetails {
+    party: Object;
+
     constructor(params: RouteParams) {
         var partyId = params.get('partyId');
+        this.party = Parties.findOne(partyId);
     }
 }
-- 
2.5.4 (Apple Git-61)


From a0858580411c6422c2c3261ce8a9e1798d44972e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 18 Oct 2015 20:45:51 +0300
Subject: [PATCH 050/132] Step 5.12:  render party details

---
 client/party-details/party-details.html | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 63fdaea..b88d435 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -1,5 +1,7 @@
 <header>
-  <h2>PARTY_NAME</h2>
+  <h2>{{party.name}}</h2>
 
-  <p>PARTY_DESCRIPTION</p>
+  <p>{{party.description}}</p>
+
+  <p>{{party.location}}</p>
 </header>
-- 
2.5.4 (Apple Git-61)


From b6fb3850e162137646b12cdf797d082b6a24d8d0 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 8 Nov 2015 23:23:24 +0300
Subject: [PATCH 52/80] Adds RouterLink dependency.

---
 client/party-details/party-details.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index b831db7..48895c5 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -6,11 +6,14 @@ import {RouteParams} from 'angular2/router';
 
 import {Parties} from 'collections/parties';
 
+import {RouterLink} from 'angular2/router';
+
 @Component({
     selector: 'party-details'
 })
 @View({
-    templateUrl: '/client/party-details/party-details.html'
+    templateUrl: '/client/party-details/party-details.html',
+    directives: [RouterLink]
 })
 export class PartyDetails {
     party: Object;
-- 
2.5.4 (Apple Git-61)


From 005c3b05536136331d9464e97edac98b89ee2381 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 8 Nov 2015 23:24:33 +0300
Subject: [PATCH 052/131] Step 6.1: add party details form

---
 client/party-details/party-details.html | 16 +++++++++++-----
 1 file changed, 11 insertions(+), 5 deletions(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index b88d435..a9aaa4d 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -1,7 +1,13 @@
-<header>
-  <h2>{{party.name}}</h2>
+<form>
+  <label>Name</label>
+  <input type="text">
 
-  <p>{{party.description}}</p>
+  <label>Description</label>
+  <input type="text">
 
-  <p>{{party.location}}</p>
-</header>
+  <label>Location</label>
+  <input type="text">
+
+  <button type="submit">Save</button>
+  <button [routerLink]="['/PartiesList']">Cancel</button>
+</form>
-- 
2.5.4 (Apple Git-61)


From 68b2448bd2ece41ff2ec1a85bc911d73c31512bc Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 8 Nov 2015 23:44:19 +0300
Subject: [PATCH 053/131] Step 6.2: bind party to form inputs

---
 client/party-details/party-details.html | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index a9aaa4d..61fda60 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -1,12 +1,12 @@
-<form>
+<form (submit)="saveParty(party)">
   <label>Name</label>
-  <input type="text">
+  <input type="text" [(ngModel)]="party.name">
 
   <label>Description</label>
-  <input type="text">
+  <input type="text" [(ngModel)]="party.description">
 
   <label>Location</label>
-  <input type="text">
+  <input type="text" [(ngModel)]="party.location">
 
   <button type="submit">Save</button>
   <button [routerLink]="['/PartiesList']">Cancel</button>
-- 
2.5.4 (Apple Git-61)


From d066f33c46cfcb27127800c2fef2c781b8ea0261 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 8 Nov 2015 23:53:48 +0300
Subject: [PATCH 054/131] Step 6.3: add submit event handler

---
 client/party-details/party-details.ts | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 48895c5..da73453 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -22,4 +22,14 @@ export class PartyDetails {
         var partyId = params.get('partyId');
         this.party = Parties.findOne(partyId);
     }
+
+    saveParty(party) {
+      Parties.update(party._id, {
+        $set: {
+          name: party.name,
+          description: party.description,
+          location: party.location
+        }
+      });
+    }
 }
-- 
2.5.4 (Apple Git-61)


From de88014b6436649324d441d7e20ed3134eb014ac Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 17 Nov 2015 19:24:23 +0300
Subject: [PATCH 055/131] Step 7.1: declare Party type

---
 typings/party.d.ts | 6 ++++++
 1 file changed, 6 insertions(+)
 create mode 100644 typings/party.d.ts

diff --git a/typings/party.d.ts b/typings/party.d.ts
new file mode 100644
index 0000000..fbafc08
--- /dev/null
+++ b/typings/party.d.ts
@@ -0,0 +1,6 @@
+declare type Party = {
+  _id?: string,
+  name: string,
+  description?: string,
+  location: string
+}
-- 
2.5.4 (Apple Git-61)


From 65993d5c1c22c003d88d7fde6b0aaae3a93fc115 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 17 Nov 2015 19:37:25 +0300
Subject: [PATCH 056/131] Step 7.2: define parties collection with Party type

---
 collections/parties.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/collections/parties.ts b/collections/parties.ts
index d1ed853..dd07460 100644
--- a/collections/parties.ts
+++ b/collections/parties.ts
@@ -1,3 +1,4 @@
 /// &lt;reference path="../typings/angular2-meteor.d.ts" />
+/// &lt;reference path="../typings/party.d.ts" />
 
-export var Parties = new Mongo.Collection('parties');
+export var Parties = new Mongo.Collection&lt;Party>('parties');
-- 
2.5.4 (Apple Git-61)


From bf659ba1469502568468805ae914999bc95923bf Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 17 Nov 2015 20:17:12 +0300
Subject: [PATCH 057/131] Step 7.3: correct parties cursor to be of the exact
 type

---
 client/parties-list/parties-list.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index be99f44..e7bb019 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -16,7 +16,7 @@ import {RouterLink} from 'angular2/router';
     directives: [PartiesForm, RouterLink]
 })
 export class PartiesList {
-    parties: Mongo.Cursor&lt;Object>;
+    parties: Mongo.Cursor&lt;Party>;
 
     constructor() {
         this.parties = Parties.find();
-- 
2.5.4 (Apple Git-61)


From ca52e6fad1c1b3c0a27a8b7f0381ba2aaa98215c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 17 Nov 2015 20:18:03 +0300
Subject: [PATCH 058/131] Step 7.4: correct party property to be of Party type

---
 client/party-details/party-details.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index da73453..ae15934 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -16,7 +16,7 @@ import {RouterLink} from 'angular2/router';
     directives: [RouterLink]
 })
 export class PartyDetails {
-    party: Object;
+    party: Party;
 
     constructor(params: RouteParams) {
         var partyId = params.get('partyId');
-- 
2.5.4 (Apple Git-61)


From 77886fe8290900a327258e50ef64556ded4c5ad5 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 17:40:30 +0300
Subject: [PATCH 062/102] Removes insecure, adds Accounts UI package

---
 .meteor/packages | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/.meteor/packages b/.meteor/packages
index 2f89e25..6160a20 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -15,5 +15,6 @@ standard-minifiers      # JS/CSS minifiers run for production mode
 es5-shim                # ECMAScript 5 compatibility for older browsers.
 
 autopublish             # Publish all data to the clients (for prototyping)
-insecure                # Allow all DB writes from clients (for prototyping)
 urigo:angular2-meteor
+accounts-password
+barbatus:ng2-meteor-accounts-ui
-- 
2.5.4 (Apple Git-61)


From ebd73d8ff08ed7051536209c54322ebe842f6f5e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 17:45:50 +0300
Subject: [PATCH 060/131] Step 8.1: add Accounts UI component to the
 PartiesList template

---
 client/parties-list/parties-list.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index 03c9607..21c7ea8 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -1,5 +1,6 @@
 <div>
   <parties-form></parties-form>
+  <accounts-ui></accounts-ui>
   <ul>
     <li *ngFor="#party of parties">
       <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
-- 
2.5.4 (Apple Git-61)


From e942f6bb99dea21db9c6e61fc21bdff835d223a0 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 17:47:00 +0300
Subject: [PATCH 061/131] Step 8.2: import dependencies

---
 client/parties-list/parties-list.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index e7bb019..f676dd8 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -1,4 +1,5 @@
 /// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+/// &lt;reference path="../../typings/meteor-accounts-ui.d.ts" />
 
 import {Component, View} from 'angular2/core';
 
@@ -8,12 +9,14 @@ import {PartiesForm} from 'client/parties-form/parties-form';
 
 import {RouterLink} from 'angular2/router';
 
+import {AccountsUI} from 'meteor-accounts-ui';
+
 @Component({
     selector: 'parties-list'
 })
 @View({
     templateUrl: '/client/parties-list/parties-list.html',
-    directives: [PartiesForm, RouterLink]
+    directives: [PartiesForm, RouterLink, AccountsUI]
 })
 export class PartiesList {
     parties: Mongo.Cursor&lt;Party>;
-- 
2.5.4 (Apple Git-61)


From f16c43c939b41593add9094c2dc87030ca6f88e2 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 18:13:17 +0300
Subject: [PATCH 062/131] Step 8.3: add parties collection security

---
 collections/parties.ts | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/collections/parties.ts b/collections/parties.ts
index dd07460..5939f6f 100644
--- a/collections/parties.ts
+++ b/collections/parties.ts
@@ -2,3 +2,18 @@
 /// &lt;reference path="../typings/party.d.ts" />
 
 export var Parties = new Mongo.Collection&lt;Party>('parties');
+
+Parties.allow({
+  insert: function(party: Object) {
+    var user = Meteor.user();
+    return !!user;
+  },
+  update: function(party: Object, fields, modifier) {
+    var user = Meteor.user();
+    return !!user;
+  },
+  remove: function(party: Object) {
+    var user = Meteor.user();
+    return !!user;
+  }
+});
-- 
2.5.4 (Apple Git-61)


From 9d0a9b12ab663221e81f3d2b571f43adf162e970 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 18:34:06 +0300
Subject: [PATCH 063/131] Step 8.4: check access and add party owner ID

---
 client/parties-form/parties-form.ts | 21 +++++++++++++--------
 1 file changed, 13 insertions(+), 8 deletions(-)

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
index 569e21d..85166b8 100644
--- a/client/parties-form/parties-form.ts
+++ b/client/parties-form/parties-form.ts
@@ -26,15 +26,20 @@ export class PartiesForm {
 
     addParty(party) {
         if (this.partiesForm.valid) {
-            Parties.insert({
-                name: party.name,
-                description: party.description,
-                location: party.location
-            });
+            if (Meteor.userId()) {
+                Parties.insert({
+                    name: party.name,
+                    description: party.description,
+                    location: party.location,
+                    owner: Meteor.userId()
+                });
 
-            (&lt;Control>this.partiesForm.controls['name']).updateValue('');
-            (&lt;Control>this.partiesForm.controls['description']).updateValue('');
-            (&lt;Control>this.partiesForm.controls['location']).updateValue('');
+                (&lt;Control>this.partiesForm.controls['name']).updateValue('');
+                (&lt;Control>this.partiesForm.controls['description']).updateValue('');
+                (&lt;Control>this.partiesForm.controls['location']).updateValue('');
+            } else {
+                alert('Please log in to add a party');
+            }
         }
     }
 }
-- 
2.5.4 (Apple Git-61)


From f540cacd890e627feef901fe50cd7e236e74ee79 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 18:35:51 +0300
Subject: [PATCH 064/131] Step 8.5: check access to change party

---
 client/party-details/party-details.ts | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index ae15934..894652a 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -24,12 +24,16 @@ export class PartyDetails {
     }
 
     saveParty(party) {
-      Parties.update(party._id, {
-        $set: {
-          name: party.name,
-          description: party.description,
-          location: party.location
-        }
-      });
+      if (Meteor.userId()) {
+        Parties.update(party._id, {
+          $set: {
+            name: party.name,
+            description: party.description,
+            location: party.location
+          }
+        });
+      } else {
+        alert('Please log in to change this party');
+      }
     }
 }
-- 
2.5.4 (Apple Git-61)


From fcc1cb0385f9525c2652c1bdc4d515c7daafde4e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 19:23:11 +0300
Subject: [PATCH 065/131] Adds base Accounts package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index 6160a20..a1a7442 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,3 +18,4 @@ autopublish             # Publish all data to the clients (for prototyping)
 urigo:angular2-meteor
 accounts-password
 barbatus:ng2-meteor-accounts-ui
+barbatus:ng2-meteor-accounts
-- 
2.5.4 (Apple Git-61)


From 735edbe1883d95b7606655ab81a69916b8bcd111 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Tue, 10 Nov 2015 19:23:40 +0300
Subject: [PATCH 066/131] Step 8.6: require user to access PartyDetails

---
 client/party-details/party-details.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 894652a..98290b7 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -1,4 +1,5 @@
 /// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+/// &lt;reference path="../../typings/meteor-accounts.d.ts" />
 
 import {Component, View} from 'angular2/core';
 
@@ -8,6 +9,8 @@ import {Parties} from 'collections/parties';
 
 import {RouterLink} from 'angular2/router';
 
+import {RequireUser} from 'meteor-accounts';
+
 @Component({
     selector: 'party-details'
 })
@@ -15,6 +18,7 @@ import {RouterLink} from 'angular2/router';
     templateUrl: '/client/party-details/party-details.html',
     directives: [RouterLink]
 })
+@RequireUser()
 export class PartyDetails {
     party: Party;
 
-- 
2.5.4 (Apple Git-61)


From afa7e81e806ff2280cbe92e285f9b0b26057ef3a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 16:54:07 +0300
Subject: [PATCH 067/131] Removes autopublish

---
 .meteor/packages | 1 -
 1 file changed, 1 deletion(-)

diff --git a/.meteor/packages b/.meteor/packages
index a1a7442..cd3ad8c 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -14,7 +14,6 @@ tracker                 # Meteor's client-side reactive programming library
 standard-minifiers      # JS/CSS minifiers run for production mode
 es5-shim                # ECMAScript 5 compatibility for older browsers.
 
-autopublish             # Publish all data to the clients (for prototyping)
 urigo:angular2-meteor
 accounts-password
 barbatus:ng2-meteor-accounts-ui
-- 
2.5.4 (Apple Git-61)


From 0a75c6ca1dfe9c607b06da82e413428c6ba12fd3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 12 Dec 2015 18:21:49 +0300
Subject: [PATCH 068/131] Corrects Party type in the party.d.ts definition file

---
 typings/party.d.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/typings/party.d.ts b/typings/party.d.ts
index fbafc08..c9d3c61 100644
--- a/typings/party.d.ts
+++ b/typings/party.d.ts
@@ -2,5 +2,6 @@ declare type Party = {
   _id?: string,
   name: string,
   description?: string,
-  location: string
+  location: string,
+  owner?: string
 }
-- 
2.5.4 (Apple Git-61)


From 8ac8fa3b47fc3c10c565711c977896be2ba99245 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 16:54:32 +0300
Subject: [PATCH 069/131] Step 9.1: publish parties collection

---
 server/parties.ts | 7 +++++++
 1 file changed, 7 insertions(+)
 create mode 100644 server/parties.ts

diff --git a/server/parties.ts b/server/parties.ts
new file mode 100644
index 0000000..b477b43
--- /dev/null
+++ b/server/parties.ts
@@ -0,0 +1,7 @@
+/// &lt;reference path="../typings/angular2-meteor.d.ts" />
+
+import {Parties} from 'collections/parties';
+
+Meteor.publish('parties', function() {
+    return Parties.find();
+});
-- 
2.5.4 (Apple Git-61)


From cc5230a9ef91fd62b463dc82c8bcfbb0ef2439dd Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 16:56:16 +0300
Subject: [PATCH 070/131] Step 9.2: import parties publications on the server

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index 80ba2c9..534fa3b 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,3 +1,4 @@
 import {loadParties} from './load_parties';
+import './parties';
 
 Meteor.startup(loadParties);
-- 
2.5.4 (Apple Git-61)


From 60a3d4b1b2e954446d3bcf452767b65960f4ad13 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 17:12:19 +0300
Subject: [PATCH 071/131] Step 9.3: extend PartiesList and make use of
 subscribe method

---
 client/parties-list/parties-list.ts | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index f676dd8..dacd95c 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -11,6 +11,8 @@ import {RouterLink} from 'angular2/router';
 
 import {AccountsUI} from 'meteor-accounts-ui';
 
+import {MeteorComponent} from 'angular2-meteor';
+
 @Component({
     selector: 'parties-list'
 })
@@ -18,11 +20,14 @@ import {AccountsUI} from 'meteor-accounts-ui';
     templateUrl: '/client/parties-list/parties-list.html',
     directives: [PartiesForm, RouterLink, AccountsUI]
 })
-export class PartiesList {
+export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
 
     constructor() {
-        this.parties = Parties.find();
+        super();
+        this.subscribe('parties', () => {
+            this.parties = Parties.find();
+        }, true);
     }
 
     removeParty(party) {
-- 
2.5.4 (Apple Git-61)


From e58d666064c505d542658c757cb042bde4d00635 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 17:23:21 +0300
Subject: [PATCH 072/131] Step 9.4: add "Public" checkbox

---
 client/parties-form/parties-form.html | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/parties-form/parties-form.html b/client/parties-form/parties-form.html
index da869fb..54cc2c8 100644
--- a/client/parties-form/parties-form.html
+++ b/client/parties-form/parties-form.html
@@ -5,5 +5,7 @@
   <input type="text" ngControl="description">
   <label>Location</label>
   <input type="text" ngControl="location">
+  <label>Public</label>
+  <input type="checkbox" ngControl="public">
   <button>Add</button>
 </form>
-- 
2.5.4 (Apple Git-61)


From 8abc4d57018fa730e3a431e0d8a929f842f5752a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 17:50:21 +0300
Subject: [PATCH 073/131] Step 9.5: update PartiesForm component

---
 client/parties-form/parties-form.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/parties-form/parties-form.ts b/client/parties-form/parties-form.ts
index 85166b8..0314bf2 100644
--- a/client/parties-form/parties-form.ts
+++ b/client/parties-form/parties-form.ts
@@ -20,7 +20,8 @@ export class PartiesForm {
         this.partiesForm = fb.group({
             name: ['', Validators.required],
             description: [''],
-            location: ['', Validators.required]
+            location: ['', Validators.required],
+            public: [false]
         });
     }
 
@@ -31,12 +32,14 @@ export class PartiesForm {
                     name: party.name,
                     description: party.description,
                     location: party.location,
+                    public: party.public,
                     owner: Meteor.userId()
                 });
 
                 (&lt;Control>this.partiesForm.controls['name']).updateValue('');
                 (&lt;Control>this.partiesForm.controls['description']).updateValue('');
                 (&lt;Control>this.partiesForm.controls['location']).updateValue('');
+                (&lt;Control>this.partiesForm.controls['public']).updateValue(false);
             } else {
                 alert('Please log in to add a party');
             }
-- 
2.5.4 (Apple Git-61)


From 805a17581ee0846ce042f163e505e0d5c26e3bb2 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 17:51:40 +0300
Subject: [PATCH 074/131] Step 9.6: add public field to the initial parties

---
 server/load_parties.ts | 9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/server/load_parties.ts b/server/load_parties.ts
index 65c914a..51bdd88 100644
--- a/server/load_parties.ts
+++ b/server/load_parties.ts
@@ -7,17 +7,20 @@ export function loadParties() {
         {
             'name': 'Dubstep-Free Zone',
             'description': 'Can we please just for an evening not listen to dubstep.',
-            'location': 'Palo Alto'
+            'location': 'Palo Alto',
+            'public': true
         },
         {
             'name': 'All dubstep all the time',
             'description': 'Get it on!',
-            'location': 'Palo Alto'
+            'location': 'Palo Alto',
+            'public': true
         },
         {
             'name': 'Savage lounging',
             'description': 'Leisure suit required. And only fiercest manners.',
-            'location': 'San Francisco'
+            'location': 'San Francisco',
+            'public': false
         }
     ];
 
-- 
2.5.4 (Apple Git-61)


From 0e34a0d32208d9ca85b04f219a7a3a8ab74e7eb6 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 18:13:29 +0300
Subject: [PATCH 075/131] Step 9.7: limit data sent to the client

---
 server/parties.ts | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/server/parties.ts b/server/parties.ts
index b477b43..2db5c15 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -3,5 +3,15 @@
 import {Parties} from 'collections/parties';
 
 Meteor.publish('parties', function() {
-    return Parties.find();
+    return Parties.find({
+        $or: [
+            { public: true },
+            {
+                $and: [
+                  { owner: this.userId },
+                  { owner: { $exists: true } }
+                ]
+            }
+        ]
+    });
 });
-- 
2.5.4 (Apple Git-61)


From 8ce67187015c11a69f92643f480df59167628d4e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 18:36:07 +0300
Subject: [PATCH 076/131] Step 9.8: add "party" publication

---
 server/parties.ts | 24 +++++++++++++++++++-----
 1 file changed, 19 insertions(+), 5 deletions(-)

diff --git a/server/parties.ts b/server/parties.ts
index 2db5c15..2f17143 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -2,16 +2,30 @@
 
 import {Parties} from 'collections/parties';
 
-Meteor.publish('parties', function() {
-    return Parties.find({
+function buildQuery(partyId?: string): Object {
+    var isAvailable = {
         $or: [
             { public: true },
             {
                 $and: [
-                  { owner: this.userId },
-                  { owner: { $exists: true } }
+                    { owner: this.userId },
+                    { owner: { $exists: true } }
                 ]
             }
         ]
-    });
+    };
+
+    if (partyId) {
+        return { $and: [{ _id: partyId }, isAvailable] };
+    }
+
+    return isAvailable;
+}
+
+Meteor.publish('parties', function() {
+    return Parties.find(buildQuery.call(this));
+});
+
+Meteor.publish('party', function(partyId) {
+    return Parties.find(buildQuery.call(this, partyId));
 });
-- 
2.5.4 (Apple Git-61)


From 62fc8aac3279533cf423cc177f94e7fc64449ea3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 18:51:42 +0300
Subject: [PATCH 077/131] Step 9.9: subscribe to "party" publication

---
 client/party-details/party-details.ts | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 98290b7..e9e9f72 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -11,6 +11,8 @@ import {RouterLink} from 'angular2/router';
 
 import {RequireUser} from 'meteor-accounts';
 
+import {MeteorComponent} from 'angular2-meteor';
+
 @Component({
     selector: 'party-details'
 })
@@ -19,12 +21,15 @@ import {RequireUser} from 'meteor-accounts';
     directives: [RouterLink]
 })
 @RequireUser()
-export class PartyDetails {
+export class PartyDetails extends MeteorComponent {
     party: Party;
 
     constructor(params: RouteParams) {
+        super();
         var partyId = params.get('partyId');
-        this.party = Parties.findOne(partyId);
+        this.subscribe('party', partyId, () => {
+            this.party = Parties.findOne(partyId);
+        }, true);
     }
 
     saveParty(party) {
-- 
2.5.4 (Apple Git-61)


From f831090596f3823dfba911af06e89448c3df216d Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 18:52:51 +0300
Subject: [PATCH 078/131] Step 9.10: update PartyDetails form to be shown when
 party is loaded

---
 client/party-details/party-details.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 61fda60..58168fc 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -1,4 +1,4 @@
-<form (submit)="saveParty(party)">
+<form (submit)="saveParty(party)" *ngIf="party">
   <label>Name</label>
   <input type="text" [(ngModel)]="party.name">
 
-- 
2.5.4 (Apple Git-61)


From 9d7288dbd361e536a280beb81229710d4d2b4f6d Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 19:36:06 +0300
Subject: [PATCH 079/131] Step 9.11: add search inputs

---
 client/parties-list/parties-list.html | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index 21c7ea8..7dd6c7e 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -1,5 +1,7 @@
 <div>
-  <parties-form></parties-form>
+  <parties-form style="float: left"></parties-form>
+  <input type="text" #searchtext placeholder="Search by Location">
+  <button type="button" (click)="search(searchtext.value)">Search</button>
   <accounts-ui></accounts-ui>
   <ul>
     <li *ngFor="#party of parties">
-- 
2.5.4 (Apple Git-61)


From 69f35970dd023e8f30447e3e18ced2a846ddf1b5 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 13 Nov 2015 19:36:32 +0300
Subject: [PATCH 080/131] Step 9.12: add search event handler

---
 client/parties-list/parties-list.ts | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index dacd95c..49dc1b8 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -33,4 +33,12 @@ export class PartiesList extends MeteorComponent {
     removeParty(party) {
         Parties.remove(party._id);
     }
+
+    search(value) {
+        if (value) {
+            this.parties = Parties.find({ location: value });
+        } else {
+            this.parties = Parties.find();
+        }
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 45665d19ae1e47daa247d6a6b14da321b78ba95a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 12 Dec 2015 18:26:23 +0300
Subject: [PATCH 081/131] Corrects Party type in the party.d.ts definition file

---
 typings/party.d.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/typings/party.d.ts b/typings/party.d.ts
index c9d3c61..1fedac3 100644
--- a/typings/party.d.ts
+++ b/typings/party.d.ts
@@ -3,5 +3,6 @@ declare type Party = {
   name: string,
   description?: string,
   location: string,
-  owner?: string
+  owner?: string,
+  public: boolean
 }
-- 
2.5.4 (Apple Git-61)


From a5194fb4804548abb020b690ec1e54a97b7db491 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 19 Dec 2015 22:16:23 +0300
Subject: [PATCH 082/131] Step 12.1: add options to the parties publication

---
 server/parties.ts | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/server/parties.ts b/server/parties.ts
index 2f17143..8fa668e 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -22,8 +22,8 @@ function buildQuery(partyId?: string): Object {
     return isAvailable;
 }
 
-Meteor.publish('parties', function() {
-    return Parties.find(buildQuery.call(this));
+Meteor.publish('parties', function(options) {
+    return Parties.find(buildQuery.call(this), options);
 });
 
 Meteor.publish('party', function(partyId) {
-- 
2.5.4 (Apple Git-61)


From 57dfc525648a64c00912a8e262e2f2cc131c5c9e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 19 Dec 2015 22:30:59 +0300
Subject: [PATCH 083/131] Step 12.2: create options and add them to the parties
 subscription

---
 client/parties-list/parties-list.ts | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 49dc1b8..25f0045 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -22,10 +22,18 @@ import {MeteorComponent} from 'angular2-meteor';
 })
 export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
+    pageSize: number = 10;
+    curPage: number = 1;
+    nameOrder: number = 1;
 
     constructor() {
         super();
-        this.subscribe('parties', () => {
+        let options = { 
+            limit: this.pageSize,
+            skip: (this.curPage - 1) * this.pageSize,
+            sort: { name: this.nameOrder }
+        }
+        this.subscribe('parties', options, () => {
             this.parties = Parties.find();
         }, true);
     }
-- 
2.5.4 (Apple Git-61)


From aabcb62f738b66f31a9fbf5e16cd1a7586dd4541 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 19 Dec 2015 22:41:56 +0300
Subject: [PATCH 084/131] Step 12.3: add sorting by party name to PartiesList

---
 client/parties-list/parties-list.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 25f0045..1818ca6 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -34,7 +34,7 @@ export class PartiesList extends MeteorComponent {
             sort: { name: this.nameOrder }
         }
         this.subscribe('parties', options, () => {
-            this.parties = Parties.find();
+            this.parties = Parties.find({}, {sort: { name: this.nameOrder }});
         }, true);
     }
 
-- 
2.5.4 (Apple Git-61)


From f6a212cd95a0653aaea236c631fa77b43df079bb Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 19 Dec 2015 22:44:38 +0300
Subject: [PATCH 085/131] Step 12.4: re-subscribe on current page changes
 reactively

---
 client/parties-list/parties-list.ts | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 1818ca6..e5b43ed 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -23,19 +23,21 @@ import {MeteorComponent} from 'angular2-meteor';
 export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
     pageSize: number = 10;
-    curPage: number = 1;
+    curPage: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     nameOrder: number = 1;
 
     constructor() {
         super();
-        let options = { 
-            limit: this.pageSize,
-            skip: (this.curPage - 1) * this.pageSize,
-            sort: { name: this.nameOrder }
-        }
-        this.subscribe('parties', options, () => {
-            this.parties = Parties.find({}, {sort: { name: this.nameOrder }});
-        }, true);
+        this.autorun(() => {
+            let options = {
+                limit: this.pageSize,
+                skip: (this.curPage.get() - 1) * this.pageSize,
+                sort: { name: this.nameOrder }
+            };
+            this.subscribe('parties', options, () => {
+                this.parties = Parties.find({}, { sort: { name: this.nameOrder } });
+            }, true);
+        });
     }
 
     removeParty(party) {
-- 
2.5.4 (Apple Git-61)


From ac2dee98bafdd28bf7040b7b942b83dc5734ab21 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 19 Dec 2015 23:01:40 +0300
Subject: [PATCH 086/131] Add reactive-var package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index cd3ad8c..75b83f7 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -18,3 +18,4 @@ urigo:angular2-meteor
 accounts-password
 barbatus:ng2-meteor-accounts-ui
 barbatus:ng2-meteor-accounts
+reactive-var
-- 
2.5.4 (Apple Git-61)


From 7bfdbc08c095eb01828cbf8aeb8c432634714b59 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 00:19:46 +0300
Subject: [PATCH 087/131] Add n2-pagination package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index 75b83f7..bcc99e0 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -19,3 +19,4 @@ accounts-password
 barbatus:ng2-meteor-accounts-ui
 barbatus:ng2-meteor-accounts
 reactive-var
+barbatus:ng2-pagination
-- 
2.5.4 (Apple Git-61)


From 39f06c1fd648dc7e58994bd4b74c15c4929ac684 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 00:44:19 +0300
Subject: [PATCH 088/131] Step 12.5: import and set up pagination components

---
 client/parties-list/parties-list.ts | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index e5b43ed..07dfe45 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -1,5 +1,6 @@
 /// &lt;reference path="../../typings/angular2-meteor.d.ts" />
 /// &lt;reference path="../../typings/meteor-accounts-ui.d.ts" />
+/// &lt;reference path="../../typings/ng2-pagination.d.ts" />
 
 import {Component, View} from 'angular2/core';
 
@@ -13,12 +14,16 @@ import {AccountsUI} from 'meteor-accounts-ui';
 
 import {MeteorComponent} from 'angular2-meteor';
 
+import {PaginationService, PaginatePipe, PaginationControlsCpm} from 'ng2-pagination';
+
 @Component({
-    selector: 'parties-list'
+    selector: 'parties-list',
+    viewProviders: [PaginationService]
 })
 @View({
     templateUrl: '/client/parties-list/parties-list.html',
-    directives: [PartiesForm, RouterLink, AccountsUI]
+    directives: [PartiesForm, RouterLink, AccountsUI, PaginationControlsCpm],
+    pipes: [PaginatePipe]
 })
 export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
-- 
2.5.4 (Apple Git-61)


From 021a6659be09b5c5f77b68405dbc89cd9c019034 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 00:53:27 +0300
Subject: [PATCH 089/131] Step 12.6: add pagination markup to the PartiesList's
 template

---
 client/parties-list/parties-list.html | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index 7dd6c7e..a5f16df 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -4,11 +4,12 @@
   <button type="button" (click)="search(searchtext.value)">Search</button>
   <accounts-ui></accounts-ui>
   <ul>
-    <li *ngFor="#party of parties">
+    <li *ngFor="#party of parties | paginate:{currentPage: 1, itemsPerPage: pageSize, totalItems: 30}">
       <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
       <button (click)="removeParty(party)">X</button>
     </li>
   </ul>
+  <pagination-controls></pagination-controls>
 </div>
-- 
2.5.4 (Apple Git-61)


From 1f1ae640a111295e6ad2665397a5efd2bd62e5a4 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 12:27:40 +0300
Subject: [PATCH 090/131] Step 12.7: handle page changed event of the
 pagination controls

---
 client/parties-list/parties-list.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index a5f16df..dcca4f3 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -11,5 +11,5 @@
       <button (click)="removeParty(party)">X</button>
     </li>
   </ul>
-  <pagination-controls></pagination-controls>
+  <pagination-controls (change)="onPageChanged($event.page)"></pagination-controls>
 </div>
-- 
2.5.4 (Apple Git-61)


From 2f7c3ccdab15554ea695226c2aee678edd23215b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 12:28:52 +0300
Subject: [PATCH 091/131] Step 12.8: add page changed event handler to the
 component

---
 client/parties-list/parties-list.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 07dfe45..4b27d3d 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -56,4 +56,8 @@ export class PartiesList extends MeteorComponent {
             this.parties = Parties.find();
         }
     }
+
+    onPageChanged(page: number) {
+        this.curPage.set(page);
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 0edfb01088a2315872663794deedfa36806052bc Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:09:27 +0300
Subject: [PATCH 092/131] Add tmeasday:publish-counts package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index bcc99e0..9aa7932 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -20,3 +20,4 @@ barbatus:ng2-meteor-accounts-ui
 barbatus:ng2-meteor-accounts
 reactive-var
 barbatus:ng2-pagination
+tmeasday:publish-counts
-- 
2.5.4 (Apple Git-61)


From f3e28b0775eeb2af050779325f5fb45f608b812d Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:09:54 +0300
Subject: [PATCH 093/131] Step 12.9: publish total number of parties

---
 server/parties.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/parties.ts b/server/parties.ts
index 8fa668e..013b111 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -23,6 +23,7 @@ function buildQuery(partyId?: string): Object {
 }
 
 Meteor.publish('parties', function(options) {
+    Counts.publish(this, 'numberOfParties', Parties.find(buildQuery.call(this)), { noReady: true });
     return Parties.find(buildQuery.call(this), options);
 });
 
-- 
2.5.4 (Apple Git-61)


From 171a97543c1958c9f87151448cc96c016fe8603a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:13:52 +0300
Subject: [PATCH 094/131] Step 12.10: handle reactive updates of the parties
 total number

---
 client/parties-list/parties-list.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 4b27d3d..4c2b1ba 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -30,6 +30,7 @@ export class PartiesList extends MeteorComponent {
     pageSize: number = 10;
     curPage: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     nameOrder: number = 1;
+    partiesSize: number = 0;
 
     constructor() {
         super();
@@ -43,6 +44,10 @@ export class PartiesList extends MeteorComponent {
                 this.parties = Parties.find({}, { sort: { name: this.nameOrder } });
             }, true);
         });
+
+        this.autorun(() => {
+            this.partiesSize = Counts.get('numberOfParties');
+        }, true);
     }
 
     removeParty(party) {
-- 
2.5.4 (Apple Git-61)


From 29bef890bda814b36e80d1a8d8427549068195a3 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:19:49 +0300
Subject: [PATCH 095/131] Step 12.11: add parties total number var in the
 template

---
 client/parties-list/parties-list.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index dcca4f3..f983878 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -4,7 +4,7 @@
   <button type="button" (click)="search(searchtext.value)">Search</button>
   <accounts-ui></accounts-ui>
   <ul>
-    <li *ngFor="#party of parties | paginate:{currentPage: 1, itemsPerPage: pageSize, totalItems: 30}">
+    <li *ngFor="#party of parties | paginate:{currentPage: 1, itemsPerPage: pageSize, totalItems: partiesSize}">
       <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
-- 
2.5.4 (Apple Git-61)


From e44cf457dc29f4d036c2aa23d2db765578045466 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:51:53 +0300
Subject: [PATCH 096/131] Step 12.12: add a sort order dropdown

---
 client/parties-list/parties-list.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index f983878..5a78db8 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -3,6 +3,13 @@
   <input type="text" #searchtext placeholder="Search by Location">
   <button type="button" (click)="search(searchtext.value)">Search</button>
   <accounts-ui></accounts-ui>
+  <h1>Parties:</h1>
+  <div>
+    <select #sort (change)="changeSortOrder(sort.value)">
+      <option value="1" selected>Ascending</option>
+      <option value="-1">Descending</option>
+    </select>
+  </div>
   <ul>
     <li *ngFor="#party of parties | paginate:{currentPage: 1, itemsPerPage: pageSize, totalItems: partiesSize}">
       <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
-- 
2.5.4 (Apple Git-61)


From 3b87decf6ea9e721fffe8b6c29975ee017a34517 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 13:52:45 +0300
Subject: [PATCH 097/131] Step 12.13: re-subscribe reactively when sort order
 changes

---
 client/parties-list/parties-list.ts | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 4c2b1ba..5187e4e 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -29,7 +29,7 @@ export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
     pageSize: number = 10;
     curPage: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
-    nameOrder: number = 1;
+    nameOrder: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     partiesSize: number = 0;
 
     constructor() {
@@ -38,10 +38,10 @@ export class PartiesList extends MeteorComponent {
             let options = {
                 limit: this.pageSize,
                 skip: (this.curPage.get() - 1) * this.pageSize,
-                sort: { name: this.nameOrder }
+                sort: { name: this.nameOrder.get() }
             };
             this.subscribe('parties', options, () => {
-                this.parties = Parties.find({}, { sort: { name: this.nameOrder } });
+                this.parties = Parties.find({}, { sort: { name: this.nameOrder.get() } });
             }, true);
         });
 
@@ -65,4 +65,8 @@ export class PartiesList extends MeteorComponent {
     onPageChanged(page: number) {
         this.curPage.set(page);
     }
+
+    changeSortOrder(nameOrder) {
+        this.nameOrder.set(parseInt(nameOrder));
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 5de58aba42aa59f3463205a248c387b7714ddc7b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 20:52:38 +0300
Subject: [PATCH 098/131] Step 12.14: add search by the party location using
 Mongo regex

---
 server/parties.ts | 13 ++++++++-----
 1 file changed, 8 insertions(+), 5 deletions(-)

diff --git a/server/parties.ts b/server/parties.ts
index 013b111..b9728c4 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -2,7 +2,7 @@
 
 import {Parties} from 'collections/parties';
 
-function buildQuery(partyId?: string): Object {
+function buildQuery(partyId: string, location: string): Object {
     var isAvailable = {
         $or: [
             { public: true },
@@ -19,12 +19,15 @@ function buildQuery(partyId?: string): Object {
         return { $and: [{ _id: partyId }, isAvailable] };
     }
 
-    return isAvailable;
+    let searchRegEx = { '$regex': '.*' + (location || '') + '.*', '$options': 'i' };
+
+    return { $and: [{ location: searchRegEx }, isAvailable] };
 }
 
-Meteor.publish('parties', function(options) {
-    Counts.publish(this, 'numberOfParties', Parties.find(buildQuery.call(this)), { noReady: true });
-    return Parties.find(buildQuery.call(this), options);
+Meteor.publish('parties', function(options, location) {
+    Counts.publish(this, 'numberOfParties',
+        Parties.find(buildQuery.call(this, null, location)), { noReady: true });
+    return Parties.find(buildQuery.call(this, null, location), options);
 });
 
 Meteor.publish('party', function(partyId) {
-- 
2.5.4 (Apple Git-61)


From 8b0baa79f179aa013a93133ffea9e6130d95963c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sun, 20 Dec 2015 21:13:58 +0300
Subject: [PATCH 099/131] Step 12.15: add reactive search by the location on
 the client

---
 client/parties-list/parties-list.ts | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 5187e4e..c89f4b4 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -31,6 +31,7 @@ export class PartiesList extends MeteorComponent {
     curPage: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     nameOrder: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     partiesSize: number = 0;
+    location: ReactiveVar&lt;string> = new ReactiveVar&lt;string>(null);
 
     constructor() {
         super();
@@ -40,7 +41,7 @@ export class PartiesList extends MeteorComponent {
                 skip: (this.curPage.get() - 1) * this.pageSize,
                 sort: { name: this.nameOrder.get() }
             };
-            this.subscribe('parties', options, () => {
+            this.subscribe('parties', options, this.location.get(), () => {
                 this.parties = Parties.find({}, { sort: { name: this.nameOrder.get() } });
             }, true);
         });
@@ -55,11 +56,8 @@ export class PartiesList extends MeteorComponent {
     }
 
     search(value) {
-        if (value) {
-            this.parties = Parties.find({ location: value });
-        } else {
-            this.parties = Parties.find();
-        }
+        this.curPage.set(1);
+        this.location.set(value);
     }
 
     onPageChanged(page: number) {
-- 
2.5.4 (Apple Git-61)


From 271e0f1a465e0bf9308b138311f2980d988c6844 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 14:37:37 +0700
Subject: [PATCH 100/131] Step 13.1: add uninvited users publication

---
 server/users.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 server/users.ts

diff --git a/server/users.ts b/server/users.ts
new file mode 100644
index 0000000..f9c21e6
--- /dev/null
+++ b/server/users.ts
@@ -0,0 +1,14 @@
+/// &lt;reference path="../typings/angular2-meteor.d.ts" />
+
+import {Parties} from 'collections/parties';
+
+Meteor.publish('uninvited', function(partyId) {
+    let party = Parties.findOne(partyId);
+
+    return Meteor.users.find({
+        _id: {
+            $nin: party.invited || [],
+            $ne: this.userId
+        }
+    });
+});
-- 
2.5.4 (Apple Git-61)


From db87405ace62e9ba5b748639ccd4d3fe441a1e39 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 14:45:37 +0700
Subject: [PATCH 101/131] Step 13.2: import users publications on the server
 start

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index 534fa3b..ae87a88 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,4 +1,5 @@
 import {loadParties} from './load_parties';
 import './parties';
+import './users';
 
 Meteor.startup(loadParties);
-- 
2.5.4 (Apple Git-61)


From d2d1474c94a102f97ed6f7aef02fcb296d160ff9 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 14:49:16 +0700
Subject: [PATCH 102/131] Step 13.3: load uninvited users

---
 client/party-details/party-details.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index e9e9f72..6d3b8d2 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -23,6 +23,7 @@ import {MeteorComponent} from 'angular2-meteor';
 @RequireUser()
 export class PartyDetails extends MeteorComponent {
     party: Party;
+    users: Mongo.Cursor&lt;Object>;
 
     constructor(params: RouteParams) {
         super();
@@ -30,6 +31,10 @@ export class PartyDetails extends MeteorComponent {
         this.subscribe('party', partyId, () => {
             this.party = Parties.findOne(partyId);
         }, true);
+
+        this.subscribe('uninvited', partyId, () => {
+          this.users = Meteor.users.find({_id: {$ne: Meteor.userId()}});
+        }, true);
     }
 
     saveParty(party) {
-- 
2.5.4 (Apple Git-61)


From 2631ec792989c1323e3e32e9fffb08e7ab24fe80 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 14:49:53 +0700
Subject: [PATCH 103/131] Add invited to the party definition

---
 typings/party.d.ts | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/typings/party.d.ts b/typings/party.d.ts
index 1fedac3..23441c9 100644
--- a/typings/party.d.ts
+++ b/typings/party.d.ts
@@ -4,5 +4,6 @@ declare type Party = {
   description?: string,
   location: string,
   owner?: string,
-  public: boolean
+  public: boolean,
+  invited?: Array&lt;string>
 }
-- 
2.5.4 (Apple Git-61)


From f61aa00b28c1904da170c0508d0d1cc76c13688d Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 14:52:39 +0700
Subject: [PATCH 104/131] Step 13.4: render uninvited users

---
 client/party-details/party-details.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 58168fc..4ba0656 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -11,3 +11,10 @@
   <button type="submit">Save</button>
   <button [routerLink]="['/PartiesList']">Cancel</button>
 </form>
+
+<ul>
+  Users to invite:
+  <li *ngFor="#user of users">
+    <div>{{ user.emails[0].address }}</div>
+  </li>
+</ul>
-- 
2.5.4 (Apple Git-61)


From ae79aba68c15f42b189b43dcf88b87ca139e9791 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 20:30:45 +0700
Subject: [PATCH 105/131] Step 13.5: add a new pipe to render user name

---
 client/lib/pipes.ts | 24 ++++++++++++++++++++++++
 1 file changed, 24 insertions(+)
 create mode 100644 client/lib/pipes.ts

diff --git a/client/lib/pipes.ts b/client/lib/pipes.ts
new file mode 100644
index 0000000..511e713
--- /dev/null
+++ b/client/lib/pipes.ts
@@ -0,0 +1,24 @@
+/// &lt;reference path="../../typings/angular2-meteor.d.ts" />
+
+import {Pipe} from 'angular2/core';
+
+@Pipe({
+    name: 'displayName'
+})
+export class DisplayName {
+    transform(user: Meteor.User): string {
+        if (!user) {
+            return '';
+        }
+
+        if (user.username) {
+            return user.username;
+        }
+        
+        if (user.emails) {
+            return user.emails[0].address;
+        }
+        
+        return '';
+    }
+}
-- 
2.5.4 (Apple Git-61)


From 1aa3ddac5fdf4cde03a7ccabdebd71c7eedc4dd2 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 20:39:03 +0700
Subject: [PATCH 106/131] Step 13.6: make use of the pipe in the template

---
 client/party-details/party-details.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 4ba0656..0a61451 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -15,6 +15,6 @@
 <ul>
   Users to invite:
   <li *ngFor="#user of users">
-    <div>{{ user.emails[0].address }}</div>
+    <div>{{ user | displayName }}</div>
   </li>
 </ul>
-- 
2.5.4 (Apple Git-61)


From 8e303df60245903144595cddb5363c20df2c9d64 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 20:40:13 +0700
Subject: [PATCH 107/131] Step 13.7: import DisplayName pipe and add it to the
 view

---
 client/party-details/party-details.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 6d3b8d2..0758465 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -13,10 +13,13 @@ import {RequireUser} from 'meteor-accounts';
 
 import {MeteorComponent} from 'angular2-meteor';
 
+import {DisplayName} from 'client/lib/pipes';
+
 @Component({
     selector: 'party-details'
 })
 @View({
+    pipes: [DisplayName],
     templateUrl: '/client/party-details/party-details.html',
     directives: [RouterLink]
 })
-- 
2.5.4 (Apple Git-61)


From 3be835cf573731273d49d449e912bbe4d98a263f Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Wed, 23 Dec 2015 21:34:51 +0700
Subject: [PATCH 108/131] Step 13.8: configure accounts UI

---
 client/app.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index b537b76..81cc5e0 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -10,6 +10,10 @@ import {PartiesList} from 'client/parties-list/parties-list';
 
 import {PartyDetails} from 'client/party-details/party-details';
 
+Accounts.ui.config({
+  passwordSignupFields: 'USERNAME_AND_EMAIL'
+});
+
 @Component({
     selector: 'app'
 })
-- 
2.5.4 (Apple Git-61)


From 59271b009259c8314be988573899c4d771e8731e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 15:12:20 +0700
Subject: [PATCH 109/131] Step 14.1: add a party invitation method

---
 collections/methods.ts | 47 +++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 47 insertions(+)
 create mode 100644 collections/methods.ts

diff --git a/collections/methods.ts b/collections/methods.ts
new file mode 100644
index 0000000..427eb70
--- /dev/null
+++ b/collections/methods.ts
@@ -0,0 +1,47 @@
+/// &lt;reference path="../typings/angular2-meteor.d.ts" />
+/// &lt;reference path="../typings/party.d.ts" />
+
+import {Parties} from './parties';
+
+function getContactEmail(user: Meteor.User): string {
+    if (user.emails && user.emails.length)
+        return user.emails[0].address;
+
+    return null;
+};
+
+Meteor.methods({
+    invite: function(partyId: string, userId: string) {
+        check(partyId, String);
+        check(userId, String);
+
+        let party = Parties.findOne(partyId);
+
+        if (!party)
+            throw new Meteor.Error('404', 'No such party!');
+
+        if (party.public)
+            throw new Meteor.Error('400', 'That party is public. No need to invite people.');
+
+        if (party.owner !== this.userId)
+            throw new Meteor.Error('403', 'No permissions!');
+
+        if (userId !== party.owner && (party.invited || []).indexOf(userId) == -1) {
+            Parties.update(partyId, { $addToSet: { invited: userId } });
+
+            let from = getContactEmail(Meteor.users.findOne(this.userId));
+            let to = getContactEmail(Meteor.users.findOne(userId));
+
+            if (Meteor.isServer && to) {
+                Email.send({
+                    from: 'noreply@socially.com',
+                    to: to,
+                    replyTo: from || undefined,
+                    subject: 'PARTY: ' + party.name,
+                    text: `Hi, I just invited you to ${party.name} on Socially.
+                        \n\nCome check it out: ${Meteor.absoluteUrl()}\n`
+                });
+            }
+        }
+    }
+});
-- 
2.5.4 (Apple Git-61)


From cc06370c4f89d4a02adedb78af48c07c7e861926 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 15:43:08 +0700
Subject: [PATCH 110/131] Step 14.2: import methods on the server side

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index ae87a88..8fe6abf 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,5 +1,6 @@
 import {loadParties} from './load_parties';
 import './parties';
 import './users';
+import 'collections/methods';
 
 Meteor.startup(loadParties);
-- 
2.5.4 (Apple Git-61)


From b2e8606cfca4b9e6523c382f8d181c9c8917e7c6 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 1 Jan 2016 19:14:20 +0700
Subject: [PATCH 111/131] Step 14.3: import methods on the client

---
 client/app.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/client/app.ts b/client/app.ts
index 81cc5e0..82239b5 100644
--- a/client/app.ts
+++ b/client/app.ts
@@ -10,6 +10,8 @@ import {PartiesList} from 'client/parties-list/parties-list';
 
 import {PartyDetails} from 'client/party-details/party-details';
 
+import 'collections/methods';
+
 Accounts.ui.config({
   passwordSignupFields: 'USERNAME_AND_EMAIL'
 });
-- 
2.5.4 (Apple Git-61)


From 27735799e14007717c765d617ad991fd40452f2a Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 15:55:43 +0700
Subject: [PATCH 112/131] Step 14.4: add "invite" button

---
 client/party-details/party-details.html | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 0a61451..b671ff0 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -16,5 +16,6 @@
   Users to invite:
   <li *ngFor="#user of users">
     <div>{{ user | displayName }}</div>
+    <button (click)="invite(user)">Invite</button>
   </li>
 </ul>
-- 
2.5.4 (Apple Git-61)


From 07ef06cb69d74d9245959d81a2c11d516dc83847 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 15:56:51 +0700
Subject: [PATCH 113/131] Step 14.5: add the click handler and call "invite"
 method

---
 client/party-details/party-details.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 0758465..bd846e8 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -53,4 +53,15 @@ export class PartyDetails extends MeteorComponent {
         alert('Please log in to change this party');
       }
     }
+
+    invite(user) {
+      this.call('invite', this.party._id, user._id, (error) => {
+        if (error) {
+          alert(`Failed to invite due to ${error}`);
+          return;
+        }
+
+        alert('User successfully invited.');
+      });
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 02ac38f14d9e987b5990d5fdaf8a22c35c4fcb9c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 16:02:54 +0700
Subject: [PATCH 114/131] Add check package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index 9aa7932..c784804 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -21,3 +21,4 @@ barbatus:ng2-meteor-accounts
 reactive-var
 barbatus:ng2-pagination
 tmeasday:publish-counts
+check
-- 
2.5.4 (Apple Git-61)


From 9c6efbeb2476dde614433780a9f98cd11e897771 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 16:08:08 +0700
Subject: [PATCH 115/131] Add email package

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index c784804..e15a342 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -22,3 +22,4 @@ reactive-var
 barbatus:ng2-pagination
 tmeasday:publish-counts
 check
+email
-- 
2.5.4 (Apple Git-61)


From 7e412243519f61a093a2c32c6f7fe012c3ef8701 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 17:03:15 +0700
Subject: [PATCH 116/131] Step 14.6: get the party reactively

---
 client/party-details/party-details.ts | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index bd846e8..ecdc0f8 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -32,8 +32,10 @@ export class PartyDetails extends MeteorComponent {
         super();
         var partyId = params.get('partyId');
         this.subscribe('party', partyId, () => {
-            this.party = Parties.findOne(partyId);
-        }, true);
+            this.autorun(() => {
+                this.party = Parties.findOne(partyId);
+            },   true);
+        });
 
         this.subscribe('uninvited', partyId, () => {
           this.users = Meteor.users.find({_id: {$ne: Meteor.userId()}});
-- 
2.5.4 (Apple Git-61)


From 3efbce497ba7eb209d3c3b1ced4f16a49997c27c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Fri, 25 Dec 2015 17:08:47 +0700
Subject: [PATCH 117/131] Step 14.7: update the users list reactively

---
 client/party-details/party-details.ts | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index ecdc0f8..e490aab 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -34,14 +34,26 @@ export class PartyDetails extends MeteorComponent {
         this.subscribe('party', partyId, () => {
             this.autorun(() => {
                 this.party = Parties.findOne(partyId);
+                this.getUsers(this.party);
             },   true);
         });
 
         this.subscribe('uninvited', partyId, () => {
-          this.users = Meteor.users.find({_id: {$ne: Meteor.userId()}});
+            this.getUsers(this.party);
         }, true);
     }
 
+    getUsers(party) {
+        if (party) {
+            this.users = Meteor.users.find({
+                _id: {
+                    $nin: party.invited || [],
+                    $ne: Meteor.userId()
+                }
+            });
+        }
+    }
+
     saveParty(party) {
       if (Meteor.userId()) {
         Parties.update(party._id, {
-- 
2.5.4 (Apple Git-61)


From 86ec74f4cdea8c1209aae8b4fd02d013ea496e93 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 19:39:34 +0700
Subject: [PATCH 118/131] Step 14.8: show private parties to the invited and
 owners only

---
 server/parties.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/server/parties.ts b/server/parties.ts
index b9728c4..a735369 100644
--- a/server/parties.ts
+++ b/server/parties.ts
@@ -10,7 +10,13 @@ function buildQuery(partyId: string, location: string): Object {
                 $and: [
                     { owner: this.userId },
                     { owner: { $exists: true } }
-                ]
+                ],
+            },
+            {
+              $and: [
+                { invited: this.userId },
+                { invited: { $exists: true } }
+              ]
             }
         ]
     };
-- 
2.5.4 (Apple Git-61)


From 86ec1cf99e58aeb1ecbfa26fe578b1c986e5224f Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 20:17:48 +0700
Subject: [PATCH 119/131] Step 14.9: add a "reply" method

---
 collections/methods.ts | 45 +++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 45 insertions(+)

diff --git a/collections/methods.ts b/collections/methods.ts
index 427eb70..d548d06 100644
--- a/collections/methods.ts
+++ b/collections/methods.ts
@@ -43,5 +43,50 @@ Meteor.methods({
                 });
             }
         }
+    },
+    reply: function(partyId, rsvp) {
+        check(partyId, String);
+        check(rsvp, String);
+
+        if (!this.userId)
+            throw new Meteor.Error('403', 'You must be logged-in to reply');
+
+        if (['yes', 'no', 'maybe'].indexOf(rsvp) === -1)
+            throw new Meteor.Error('400', 'Invalid RSVP');
+
+        let party = Parties.findOne({ _id: partyId });
+
+        if (!party)
+            throw new Meteor.Error('404', 'No such party');
+
+        if (party.owner === this.userId)
+            throw new Meteor.Error('500', 'You are the owner!');
+
+        if (!party.public && (!party.invited || party.invited.indexOf(this.userId) == -1))
+            throw new Meteor.Error('403', 'No such party'); // its private, but let's not tell this to the user
+ 
+        let rsvpIndex = party.rsvps ? party.rsvps.findIndex((rsvp) => rsvp.userId === this.userId) : -1;
+
+        if (rsvpIndex !== -1) {
+            // update existing rsvp entry
+            if (Meteor.isServer) {
+                // update the appropriate rsvp entry with $
+                Parties.update(
+                    { _id: partyId, 'rsvps.userId': this.userId },
+                    { $set: { 'rsvps.$.response': rsvp } });
+            } else {
+                // minimongo doesn't yet support $ in modifier. as a temporary
+                // workaround, make a modifier that uses an index. this is
+                // safe on the client since there's only one thread.
+                let modifier = { $set: {} };
+                modifier.$set['rsvps.' + rsvpIndex + '.response'] = rsvp;
+
+                Parties.update(partyId, modifier);
+            }
+        } else {
+            // add new rsvp entry
+            Parties.update(partyId,
+                { $push: { rsvps: { userId: this.userId, response: rsvp } } });
+        }
     }
 });
-- 
2.5.4 (Apple Git-61)


From 84347d5a337447d8dd1f526b26b7e6931a9d8f3b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 20:10:46 +0700
Subject: [PATCH 120/131] Step 14.10: update the party typings

---
 typings/party.d.ts | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/typings/party.d.ts b/typings/party.d.ts
index 23441c9..82ac46a 100644
--- a/typings/party.d.ts
+++ b/typings/party.d.ts
@@ -5,5 +5,11 @@ declare type Party = {
   location: string,
   owner?: string,
   public: boolean,
-  invited?: Array&lt;string>
+  invited?: Array&lt;string>,
+  rsvps?: Array&lt;RSVP>
+}
+
+declare type RSVP = {
+  userId: string,
+  response: string
 }
-- 
2.5.4 (Apple Git-61)


From 8d964d665f58eb008f04f0e0ad9925e296f57ea2 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 20:33:48 +0700
Subject: [PATCH 121/131] Step 14.11: update PartyDetails view with the three
 response buttons

---
 client/party-details/party-details.html | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index b671ff0..971a2d7 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -19,3 +19,10 @@
     <button (click)="invite(user)">Invite</button>
   </li>
 </ul>
+
+<div>
+  <h2>Reply to the invitation</h2>
+  <input type="button" value="I'm going!" (click)="reply('yes')">
+  <input type="button" value="Maybe" (click)="reply('maybe')">
+  <input type="button" value="No" (click)="reply('no')">
+</div>
-- 
2.5.4 (Apple Git-61)


From 1c4988ef4e7260673bd36f3603116ae5cb0e0223 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 20:37:05 +0700
Subject: [PATCH 122/131] Step 14.12: handle reply events in the PartyDetails
 component

---
 client/party-details/party-details.ts | 11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index e490aab..76c9f34 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -78,4 +78,15 @@ export class PartyDetails extends MeteorComponent {
         alert('User successfully invited.');
       });
     }
+
+    reply(rsvp) {
+      this.call('reply', this.party._id, rsvp, (error) => {
+        if (error) {
+          alert(`Failed to reply due to ${error}`);
+        }
+        else {
+          alert('You successfully replied.');
+        }
+      });
+    }
 }
-- 
2.5.4 (Apple Git-61)


From ec3ca63cd637ae0feffce7a9fbb813d737c19830 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 21:34:49 +0700
Subject: [PATCH 123/131] Step 14.13: add a new response counting pipe

---
 client/lib/pipes.ts | 34 ++++++++++++++++++++++++++++++++++
 1 file changed, 34 insertions(+)

diff --git a/client/lib/pipes.ts b/client/lib/pipes.ts
index 511e713..131c595 100644
--- a/client/lib/pipes.ts
+++ b/client/lib/pipes.ts
@@ -2,6 +2,10 @@
 
 import {Pipe} from 'angular2/core';
 
+import {Parties} from 'collections/parties';
+
+import {MeteorComponent} from 'angular2-meteor';
+
 @Pipe({
     name: 'displayName'
 })
@@ -22,3 +26,33 @@ export class DisplayName {
         return '';
     }
 }
+
+@Pipe({
+    name: 'rsvp',
+    pure: false
+})
+export class RsvpPipe extends MeteorComponent {
+    init: boolean = false;
+    total: number = 0;
+
+    transform(party: Party, args: any[]): number {
+        let type = args[0];
+        if (!type) {
+            return 0;
+        }
+
+        if (!this.init) {
+            this.autorun(() => {
+                party = Parties.findOne(party._id);
+                if (party) {
+                    this.total = party.rsvps ?
+                        party.rsvps.filter(rsvp => rsvp.response === type).length : 0;
+                }
+            }, true);
+            this.init = true;
+        }
+                    
+        return this.total;
+    }
+}
+
-- 
2.5.4 (Apple Git-61)


From 98d90e824afba5f56bff15853fb8f18c736e909b Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 21:35:28 +0700
Subject: [PATCH 124/131] Step 14.14: display response statistics in the list

---
 client/parties-list/parties-list.html | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index 5a78db8..bf63448 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -16,6 +16,12 @@
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
       <button (click)="removeParty(party)">X</button>
+      <div>
+        Who is coming:
+        Yes - {{party | rsvp:'yes'}}
+        Maybe - {{party | rsvp:'maybe'}}
+        No - {{party | rsvp:'no'}}
+      </div>
     </li>
   </ul>
   <pagination-controls (change)="onPageChanged($event.page)"></pagination-controls>
-- 
2.5.4 (Apple Git-61)


From 5048a057bf0b6302fafefdd379a7a96e9ec83faf Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Sat, 26 Dec 2015 21:36:23 +0700
Subject: [PATCH 125/131] Step 14.15: import the RsvpPipe pipe

---
 client/parties-list/parties-list.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index c89f4b4..44ac226 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -16,6 +16,8 @@ import {MeteorComponent} from 'angular2-meteor';
 
 import {PaginationService, PaginatePipe, PaginationControlsCpm} from 'ng2-pagination';
 
+import {RsvpPipe} from 'client/lib/pipes';
+
 @Component({
     selector: 'parties-list',
     viewProviders: [PaginationService]
@@ -23,7 +25,7 @@ import {PaginationService, PaginatePipe, PaginationControlsCpm} from 'ng2-pagina
 @View({
     templateUrl: '/client/parties-list/parties-list.html',
     directives: [PartiesForm, RouterLink, AccountsUI, PaginationControlsCpm],
-    pipes: [PaginatePipe]
+    pipes: [PaginatePipe, RsvpPipe]
 })
 export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
-- 
2.5.4 (Apple Git-61)


From 0006a8a5476a7e29ee985de57bd49647788ed3f5 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 17:42:26 +0700
Subject: [PATCH 126/131] Step 15.1: inject Meteor user and add isOwner method
 into the PartiesList

---
 client/parties-list/parties-list.ts | 13 +++++++++++++
 1 file changed, 13 insertions(+)

diff --git a/client/parties-list/parties-list.ts b/client/parties-list/parties-list.ts
index 44ac226..549445d 100644
--- a/client/parties-list/parties-list.ts
+++ b/client/parties-list/parties-list.ts
@@ -1,6 +1,7 @@
 /// &lt;reference path="../../typings/angular2-meteor.d.ts" />
 /// &lt;reference path="../../typings/meteor-accounts-ui.d.ts" />
 /// &lt;reference path="../../typings/ng2-pagination.d.ts" />
+/// &lt;reference path="../../typings/meteor-accounts.d.ts" />
 
 import {Component, View} from 'angular2/core';
 
@@ -12,6 +13,8 @@ import {RouterLink} from 'angular2/router';
 
 import {AccountsUI} from 'meteor-accounts-ui';
 
+import {InjectUser} from 'meteor-accounts';
+
 import {MeteorComponent} from 'angular2-meteor';
 
 import {PaginationService, PaginatePipe, PaginationControlsCpm} from 'ng2-pagination';
@@ -27,6 +30,7 @@ import {RsvpPipe} from 'client/lib/pipes';
     directives: [PartiesForm, RouterLink, AccountsUI, PaginationControlsCpm],
     pipes: [PaginatePipe, RsvpPipe]
 })
+@InjectUser()
 export class PartiesList extends MeteorComponent {
     parties: Mongo.Cursor&lt;Party>;
     pageSize: number = 10;
@@ -34,6 +38,7 @@ export class PartiesList extends MeteorComponent {
     nameOrder: ReactiveVar&lt;number> = new ReactiveVar&lt;number>(1);
     partiesSize: number = 0;
     location: ReactiveVar&lt;string> = new ReactiveVar&lt;string>(null);
+    user: Meteor.User;
 
     constructor() {
         super();
@@ -69,4 +74,12 @@ export class PartiesList extends MeteorComponent {
     changeSortOrder(nameOrder) {
         this.nameOrder.set(parseInt(nameOrder));
     }
+
+    isOwner(party) {
+        if (this.user) {
+            return this.user._id === party.owner;
+        }
+
+        return false;
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 6ebe14c7e6d576d5c1054953af265ccce7b91c0e Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 17:46:08 +0700
Subject: [PATCH 127/131] Step 15.2: use the hidden attribute in the
 PartiesList template

---
 client/parties-list/parties-list.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/parties-list/parties-list.html b/client/parties-list/parties-list.html
index bf63448..f87d7d0 100644
--- a/client/parties-list/parties-list.html
+++ b/client/parties-list/parties-list.html
@@ -1,5 +1,5 @@
 <div>
-  <parties-form style="float: left"></parties-form>
+  <parties-form [hidden]="!user" style="float: left"></parties-form>
   <input type="text" #searchtext placeholder="Search by Location">
   <button type="button" (click)="search(searchtext.value)">Search</button>
   <accounts-ui></accounts-ui>
@@ -15,7 +15,7 @@
       <a [routerLink]="['/PartyDetails', {partyId: party._id}]">{{party.name}}</a>
       <p>{{party.description}}</p>
       <p>{{party.location}}</p>
-      <button (click)="removeParty(party)">X</button>
+      <button [hidden]="!isOwner(party)" (click)="removeParty(party)">X</button>
       <div>
         Who is coming:
         Yes - {{party | rsvp:'yes'}}
-- 
2.5.4 (Apple Git-61)


From 3d59383ce844eb48b2756b6238595cc2ccce6a0c Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 18:48:33 +0700
Subject: [PATCH 128/131] Step 15.3: add isOwner property into the PartyDetails

---
 client/party-details/party-details.ts | 12 +++++++++++-
 1 file changed, 11 insertions(+), 1 deletion(-)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 76c9f34..28c1936 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -9,7 +9,7 @@ import {Parties} from 'collections/parties';
 
 import {RouterLink} from 'angular2/router';
 
-import {RequireUser} from 'meteor-accounts';
+import {RequireUser, InjectUser} from 'meteor-accounts';
 
 import {MeteorComponent} from 'angular2-meteor';
 
@@ -24,9 +24,11 @@ import {DisplayName} from 'client/lib/pipes';
     directives: [RouterLink]
 })
 @RequireUser()
+@InjectUser()
 export class PartyDetails extends MeteorComponent {
     party: Party;
     users: Mongo.Cursor&lt;Object>;
+    user: Meteor.User;
 
     constructor(params: RouteParams) {
         super();
@@ -89,4 +91,12 @@ export class PartyDetails extends MeteorComponent {
         }
       });
     }
+
+    get isOwner() {
+        if (this.party && this.user) {
+            return this.user._id === this.party.owner;
+        }
+
+        return false;
+    }
 }
-- 
2.5.4 (Apple Git-61)


From 0561d0143069005370b772096d64cc50553437ef Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 18:49:13 +0700
Subject: [PATCH 129/131] Step 15.4: add disable attribute bindings

---
 client/party-details/party-details.html | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 971a2d7..95e6e57 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -1,14 +1,14 @@
 <form (submit)="saveParty(party)" *ngIf="party">
   <label>Name</label>
-  <input type="text" [(ngModel)]="party.name">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.name">
 
   <label>Description</label>
-  <input type="text" [(ngModel)]="party.description">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.description">
 
   <label>Location</label>
-  <input type="text" [(ngModel)]="party.location">
+  <input [disabled]="!isOwner" type="text" [(ngModel)]="party.location">
 
-  <button type="submit">Save</button>
+  <button [disabled]="!isOwner" type="submit">Save</button>
   <button [routerLink]="['/PartiesList']">Cancel</button>
 </form>
 
-- 
2.5.4 (Apple Git-61)


From 45f6e606b76f775bd221ee5f78ab7590cc727396 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 19:40:08 +0700
Subject: [PATCH 130/131] Step 15.5: add isPublic and isInvited properties

---
 client/party-details/party-details.ts | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/client/party-details/party-details.ts b/client/party-details/party-details.ts
index 28c1936..e6c922f 100644
--- a/client/party-details/party-details.ts
+++ b/client/party-details/party-details.ts
@@ -99,4 +99,21 @@ export class PartyDetails extends MeteorComponent {
 
         return false;
     }
+
+    get isPublic() {
+        if (this.party) {
+            return this.party.public;
+        }
+
+        return false;
+    }
+
+    get isInvited() {
+        if (this.party && this.user) {
+            let invited = this.party.invited || [];
+            return invited.indexOf(this.user._id) !== -1;
+        }
+
+        return false;
+    }
 }
-- 
2.5.4 (Apple Git-61)


From e2b5f4f29b9b16de1ae40b1bb3f68e7b7005f3e6 Mon Sep 17 00:00:00 2001
From: barbatus <alex.borodach@gmail.com>
Date: Mon, 28 Dec 2015 19:40:32 +0700
Subject: [PATCH 131/131] Step 15.6: make use of the properties in the template

---
 client/party-details/party-details.html | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/client/party-details/party-details.html b/client/party-details/party-details.html
index 95e6e57..1301c19 100644
--- a/client/party-details/party-details.html
+++ b/client/party-details/party-details.html
@@ -12,7 +12,7 @@
   <button [routerLink]="['/PartiesList']">Cancel</button>
 </form>
 
-<ul>
+<ul *ngIf="isOwner || isPublic">
   Users to invite:
   <li *ngFor="#user of users">
     <div>{{ user | displayName }}</div>
@@ -20,7 +20,7 @@
   </li>
 </ul>
 
-<div>
+<div *ngIf="isInvited">
   <h2>Reply to the invitation</h2>
   <input type="button" value="I'm going!" (click)="reply('yes')">
   <input type="button" value="Maybe" (click)="reply('maybe')">
-- 
2.5.4 (Apple Git-61)

